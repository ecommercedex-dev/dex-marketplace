<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fashion Products | Dex‚Ñ¢</title>
  <link rel="icon" href="../DEX_FAVICON/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    :root { 
      --primary: #E91E63; 
      --dark: #0f0f0f;
      --card: #1a1a1a;
      --border: #2a2a2a;
      --text: #e0e0e0;
      --text-dim: #888;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Quicksand', sans-serif; background: var(--dark); color: var(--text); line-height: 1.6; }
    
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15, 15, 15, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
    }
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      font-family: 'Fredoka One', cursive;
      font-size: 1.5rem;
      color: var(--primary);
      text-decoration: none;
    }
    .back-btn {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }
    .back-btn:hover {
      background: var(--primary);
      color: #000;
      border-color: var(--primary);
    }
    
    .hero-banner {
      width: 100%;
      height: 300px;
      background: linear-gradient(135deg, var(--primary), #F48FB1), url('images/fashion.webp') center/cover;
      background-blend-mode: overlay;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }
    .hero-content { padding: 2rem; }
    .hero-icon { font-size: 4rem; margin-bottom: 1rem; }
    .hero-banner h1 { font-family: 'Fredoka One', cursive; font-size: 2.5rem; margin-bottom: 0.5rem; text-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    .hero-banner p { font-size: 1.1rem; opacity: 0.95; }
    .hero-count { font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.9; }
    
    .breadcrumb {
      max-width: 1400px;
      margin: 1.5rem auto;
      padding: 0 2rem;
      font-size: 0.9rem;
      color: var(--text-dim);
    }
    .breadcrumb a { color: var(--primary); text-decoration: none; }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem 4rem;
    }
    
    .search-bar {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      gap: 0.75rem;
    }
    .search-bar input {
      flex: 1;
      background: var(--dark);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
    }
    .search-bar input:focus { outline: none; border-color: var(--primary); }
    .search-bar button {
      background: var(--primary);
      color: #000;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }
    .search-bar button:hover { opacity: 0.9; }
    
    .safety-tips {
      background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(244, 143, 177, 0.1));
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .safety-tips .icon { font-size: 1.5rem; color: var(--primary); }
    .safety-tips .content { flex: 1; }
    .safety-tips .label { font-size: 0.75rem; color: var(--primary); font-weight: 700; text-transform: uppercase; margin-bottom: 0.25rem; }
    .safety-tips .tip { font-size: 0.9rem; color: var(--text); }
    
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .sort-btn {
      padding: 0.75rem 1.5rem;
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }
    .sort-btn:hover, .sort-btn.active {
      background: var(--primary);
      color: #000;
      border-color: var(--primary);
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1.5rem;
    }
    .product-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: 0.2s;
    }
    .product-card:hover {
      border-color: var(--primary);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(233, 30, 99, 0.2);
    }
    .product-card img { width: 100%; height: 220px; object-fit: cover; background: var(--dark); }
    .product-info { padding: 1rem; }
    .product-name { font-weight: 600; margin-bottom: 0.5rem; }
    .product-price { font-size: 1.25rem; font-weight: 700; color: var(--primary); }
    .trust-badges { display: flex; gap: 0.5rem; align-items: center; margin: 0.5rem 0; font-size: 0.75rem; flex-wrap: wrap; }
    .badge { background: rgba(233, 30, 99, 0.1); color: var(--primary); padding: 0.25rem 0.5rem; border-radius: 4px; display: flex; align-items: center; gap: 0.25rem; }
    .verified { color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
    .seller-info { display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; font-size: 0.8rem; color: var(--text-dim); }
    .rating { color: #FFC107; font-weight: 600; }
    .report-link { font-size: 0.7rem; color: var(--text-dim); text-align: right; margin-top: 0.5rem; cursor: pointer; }
    .report-link:hover { color: var(--primary); text-decoration: underline; }
    
    .loading {
      text-align: center;
      padding: 4rem;
      color: var(--text-dim);
    }
    .loading i {
      font-size: 2rem;
      color: var(--primary);
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .hero-banner { height: 250px; }
      .hero-banner h1 { font-size: 2rem; }
      .products-grid { grid-template-columns: repeat(2, 1fr); gap: 1rem; }
      .product-card img { height: 180px; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="../Dex-home.html" class="logo">Dex‚Ñ¢</a>
      <button class="back-btn" onclick="history.back()">
        <i class="fas fa-arrow-left"></i> Back
      </button>
    </div>
  </header>

  <div class="hero-banner">
    <div class="hero-content">
      <div class="hero-icon" id="hero-icon">üëî</div>
      <h1 id="hero-title">Men's Shirts</h1>
      <p id="hero-subtitle">Discover quality shirts from verified STU sellers</p>
      <div class="hero-count" id="product-count">Loading...</div>
    </div>
  </div>

  <div class="breadcrumb">
    <a href="../Dex-home.html">Home</a> > 
    <a href="fashion.html">Fashion</a> > 
    <a href="#" id="gender-link">Men</a> > 
    <span id="subcategory-name">Shirts</span>
  </div>

  <div class="container">
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Search products..." onkeyup="searchProducts(event)">
      <button onclick="searchProducts()"><i class="fas fa-search"></i> Search</button>
    </div>
    
    <div class="safety-tips">
      <div class="icon"><i class="fas fa-shield-alt"></i></div>
      <div class="content">
        <div class="label">Safety Tip</div>
        <div class="tip" id="safety-tip">Loading...</div>
      </div>
    </div>
    
    <div class="filters">
      <button class="sort-btn active" onclick="sortProducts('latest')">Latest</button>
      <button class="sort-btn" onclick="sortProducts('price-low')">Price: Low-High</button>
      <button class="sort-btn" onclick="sortProducts('price-high')">Price: High-Low</button>
    </div>

    <div class="products-grid" id="products-grid">
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading products...</p>
      </div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const gender = urlParams.get('gender') || 'men';
    const subcategory = urlParams.get('sub') || 'shirts';
    
    const subcategoryIcons = {
      shirts: 'üëî', pants: 'üëñ', shoes: 'üëû', bags: 'üéí', watches: '‚åö', accessories: 'üï∂Ô∏è',
      dresses: 'üëó', tops: 'üëö', skirts: 'ü©±', jewelry: 'üíç'
    };
    
    document.getElementById('hero-icon').textContent = subcategoryIcons[subcategory] || 'üëï';
    document.getElementById('hero-title').textContent = `${gender === 'men' ? "Men's" : "Women's"} ${subcategory.charAt(0).toUpperCase() + subcategory.slice(1)}`;
    document.getElementById('gender-link').textContent = gender === 'men' ? 'Men' : 'Women';
    document.getElementById('gender-link').href = `fashion-subcategory.html?gender=${gender}`;
    document.getElementById('subcategory-name').textContent = subcategory.charAt(0).toUpperCase() + subcategory.slice(1);
    
    let allProducts = [];
    let displayedProducts = [];
    
    const safetyTips = [
      "Always meet sellers in public places on campus",
      "Inspect items carefully before making payment",
      "Never share your bank PIN or password with anyone",
      "Use Dex's secure messaging system for communication",
      "Report suspicious listings immediately",
      "Verify seller's student ID before transactions",
      "Take photos of items before purchase as proof",
      "Avoid deals that seem too good to be true",
      "Keep records of all your transactions",
      "Meet during daylight hours when possible",
      "Bring a friend when meeting new sellers",
      "Check product authenticity before buying",
      "Don't send money before seeing the item",
      "Use campus security points for exchanges",
      "Read seller reviews and ratings carefully",
      "Trust your instincts - if it feels wrong, walk away",
      "Verify product condition matches description",
      "Keep your personal information private",
      "Use secure payment methods only",
      "Don't rush into purchases - take your time",
      "Ask for receipts or proof of purchase",
      "Check return and refund policies",
      "Beware of sellers asking for advance payment",
      "Verify contact information is legitimate",
      "Report scammers to campus authorities",
      "Don't share your room number with strangers",
      "Compare prices across multiple listings",
      "Ask questions before committing to buy",
      "Check if warranty or guarantee is included",
      "Avoid transactions in isolated areas",
      "Keep your phone charged during meetups",
      "Tell someone where you're going for exchanges",
      "Don't feel pressured to buy immediately",
      "Verify seller identity through student portal",
      "Use Dex's dispute resolution if issues arise",
      "Check product serial numbers when applicable",
      "Be cautious of sellers with no reviews",
      "Save all chat conversations as evidence",
      "Don't accept opened or tampered packages",
      "Report fake or counterfeit products immediately"
    ];
    
    let currentTipIndex = 0;
    
    function rotateTips() {
      document.getElementById('safety-tip').textContent = safetyTips[currentTipIndex];
      currentTipIndex = (currentTipIndex + 1) % safetyTips.length;
    }
    
    setInterval(rotateTips, 5000);
    rotateTips();
    
    async function loadProducts() {
      try {
        const res = await fetch('http://localhost:5000/api/products');
        const data = await res.json();
        const products = data.products || data || [];
        
        console.log('Total products:', products.length);
        console.log('Looking for: category=fashion, subCategory=' + subcategory);
        
        allProducts = products.filter(p => {
          if (!p.deployed) return false;
          
          const categoryMatch = p.category?.toLowerCase() === 'fashion';
          const subCategoryMatch = p.subCategory?.toLowerCase() === subcategory.toLowerCase();
          
          let genderMatch = true;
          if (gender && p.details) {
            const details = typeof p.details === 'string' ? JSON.parse(p.details) : p.details;
            const productGender = details.Gender || details.gender;
            genderMatch = productGender?.toLowerCase() === gender.toLowerCase();
          }
          
          const match = categoryMatch && subCategoryMatch && genderMatch;
          if (match) console.log('Match found:', p.name, p.category, p.subCategory, 'Gender:', gender);
          return match;
        });
        
        console.log('Filtered products:', allProducts.length);
        document.getElementById('product-count').textContent = `${allProducts.length} products available`;
        renderProducts(allProducts);
      } catch (err) {
        console.error('Load error:', err);
        document.getElementById('products-grid').innerHTML = '<div class="loading"><p>Unable to load products</p></div>';
      }
    }
    
    function searchProducts(event) {
      if (event && event.key !== 'Enter' && event.type === 'keyup') return;
      
      const query = document.getElementById('search-input').value.toLowerCase();
      const filtered = query ? allProducts.filter(p => 
        p.name.toLowerCase().includes(query) || 
        p.description?.toLowerCase().includes(query)
      ) : allProducts;
      
      renderProducts(filtered);
    }
    
    function renderProducts(products) {
      displayedProducts = products;
      const grid = document.getElementById('products-grid');
      
      if (!products.length) {
        grid.innerHTML = '<div class="loading"><p>No products found</p></div>';
        return;
      }
      
      grid.innerHTML = products.map(p => {
        const rating = (Math.random() * 1.5 + 3.5).toFixed(1);
        const reviews = Math.floor(Math.random() * 200 + 10);
        const verified = Math.random() > 0.3;
        const responseTime = Math.floor(Math.random() * 4 + 1);
        
        return `
        <div class="product-card" onclick="location.href='Dex-product-details.html?id=${p.id}'">
          <img src="${p.images?.[0] ? 'http://localhost:5000' + p.images[0] : 'images/placeholder.jpg'}" alt="${p.name}" loading="lazy">
          <div class="product-info">
            <div class="product-name">${p.name}</div>
            <div class="seller-info">
              <span class="rating">‚≠ê ${rating} (${reviews})</span>
              ${verified ? '<span class="badge verified"><i class="fas fa-check-circle"></i> Verified</span>' : ''}
            </div>
            <div class="trust-badges">
              <span class="badge"><i class="fas fa-shield-alt"></i> Secure</span>
              <span class="badge"><i class="fas fa-clock"></i> ~${responseTime}hrs</span>
            </div>
            <div class="product-price">‚Çµ${Number(p.price).toLocaleString()}</div>
            <div class="report-link" onclick="event.stopPropagation(); alert('Report submitted. We will review this listing.');">‚ö† Report</div>
          </div>
        </div>
      `}).join('');
    }
    
    function sortProducts(type) {
      document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      let sorted = [...displayedProducts];
      if (type === 'price-low') sorted.sort((a, b) => a.price - b.price);
      else if (type === 'price-high') sorted.sort((a, b) => b.price - a.price);
      
      renderProducts(sorted);
    }
    
    loadProducts();
  </script>
</body>
</html>
