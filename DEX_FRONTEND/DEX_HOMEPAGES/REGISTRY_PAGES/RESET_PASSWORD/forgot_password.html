<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dex‚Ñ¢ - Forgot Password</title>

    <link
      rel="icon"
      type="image/x-icon"
      href="../../../DEX_FAVICON/favicon.png"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&family=Fredoka+One&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <style>
      body {
        font-family: "Quicksand", sans-serif;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(15, 15, 15, 0.9)),
          url("Images/pexels-cottonbro-7407369.jpg") center/cover no-repeat;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        position: relative;
        color: #fff;
      }

      #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 0;
        top: 0;
        left: 0;
      }

      header,
      footer {
        position: relative;
        z-index: 2;
      }

      main {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 2;
      }

      header {
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(10px);
      }

      header h1 a {
        color: #f4c542;
        text-decoration: none;
        font-family: "Fredoka One", cursive;
        font-size: 1.6rem;
      }

      nav ul {
        list-style: none;
        display: flex;
        gap: 20px;
        margin: 0;
        padding: 0;
      }

      nav a {
        color: #fff;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      nav a:hover {
        color: #f4c542;
      }

      form {
        background: rgba(0, 0, 0, 0.55);
        padding: 30px 25px;
        border-radius: 15px;
        width: 100%;
        max-width: 350px;
        text-align: center;
        backdrop-filter: blur(12px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        animation: fadeInUp 1.2s ease;
      }

      form:hover {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h2 {
        color: #f4c542;
        margin-bottom: 10px;
      }

      p {
        font-size: 13px;
        color: #ddd;
        margin-bottom: 10px;
      }

      .input-group {
        position: relative;
        margin: 20px 0;
        width: 100%;
      }

      .input-group i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #aaa;
        font-size: 15px;
      }

      .input-group input {
        width: 100%;
        padding: 12px 12px 12px 38px;
        border: 1px solid #555;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        outline: none;
        font-size: 14px;
        box-sizing: border-box;
        transition: border-color 0.3s ease, background 0.3s ease;
      }

      .input-group input:focus {
        border-color: #f4c542;
        background: rgba(255, 255, 255, 0.12);
      }

      button {
        width: 100%;
        padding: 12px;
        background: #f4c542;
        color: #000;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.2s ease;
      }

      button:hover {
        background: #d9aa25;
        transform: scale(1.03);
      }

      footer {
        background: rgba(0, 0, 0, 0.7);
        text-align: center;
        padding: 15px;
        font-size: 13px;
        color: #ddd;
      }

      footer a {
        color: #f4c542;
        text-decoration: underline;
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: rgba(0, 0, 0, 0.85);
        color: #f4c542;
        padding: 15px 20px;
        border-radius: 8px;
        font-size: 14px;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s ease, transform 0.4s ease;
        z-index: 999;
        border-left: 3px solid #f4c542;
        backdrop-filter: blur(6px);
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>

  <body>
    <div id="particles-js"></div>

    <header>
      <h1><a href="../../../Dex-home.html">Dex‚Ñ¢</a></h1>
      <nav>
        <ul>
          <li><a href="../../../Dex-home.html">üè† Home</a></li>
          <li>
            <a href="../../../DEX_CONTACT/Dex-contact.html">üìû Contact</a>
          </li>
        </ul>
      </nav>
    </header>

    <main>
      <form id="forgotForm">
        <h2>üîë Forgot Password</h2>
        <p></p>

        <div class="input-group">
          <i class="fa fa-envelope"></i>
          <input
            type="email"
            name="contact"
            placeholder="Enter your email"
            required
          />
        </div>

        <button type="submit">üì© Send Reset Link</button>

        <p style="margin-top: 15px; font-size: 12px">
          Remembered your password?
          <a href="../seller_sign_in.html" style="color: #f4c542"
            >üîô Back to Seller Login</a
          >
        </p>
        <p>
          <a href="../Sign_in.html" style="color: #f4c542"
            >üë§ Back to Customer Login</a
          >
        </p>
      </form>
    </main>

    <footer>
      <p>&copy; 2025 Dex‚Ñ¢. All rights reserved ‚ö°</p>
      <p>
        <a href="../../DEX_LEGALPAGES/privacy.html">üîí Privacy Policy</a> |
        <a href="../../DEX_LEGALPAGES/terms.html">üìú Terms of Service</a>
      </p>
    </footer>

    <div id="toast" class="toast"></div>

    <script>
      // === Particles.js Config ===
      particlesJS("particles-js", {
        particles: {
          number: { value: 65, density: { enable: true, value_area: 800 } },
          color: { value: "#f4c542" },
          shape: { type: "circle" },
          opacity: { value: 0.3, random: true },
          size: { value: 2, random: true },
          move: {
            enable: true,
            speed: 0.4,
            direction: "none",
            out_mode: "out",
          },
        },
        interactivity: {
          events: { onhover: { enable: false }, onclick: { enable: false } },
        },
        retina_detect: true,
      });

      // === Role-Aware Forgot Password JS ===
      const form = document.querySelector("#forgotForm");
      const toast = document.getElementById("toast");

      // Toast helper
      function showToast(message) {
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 4000);
      }

      // Detect role from URL (?role=buyer or ?role=seller), default to buyer
      const params = new URLSearchParams(window.location.search);
      const role = params.get("role") === "seller" ? "seller" : "buyer";

      // Update form instruction dynamically based on role
      document.querySelector("p").textContent =
        role === "seller"
          ? "Enter your seller email and we‚Äôll send you a reset code üîê"
          : "Enter your customer email and we‚Äôll send you a reset code üîê";

      // Map endpoints based on role
      const endpoints = {
        buyer: "http://localhost:5000/api/buyers/forgot-password", // updated to 6-digit code endpoint
        seller: "http://localhost:5000/api/Sellers/send-reset-code",
      };

      // Map labels for toast messages
      const roleLabels = {
        buyer: "customer",
        seller: "seller",
      };

      // Handle form submission
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const contact = form
          .querySelector('input[name="contact"]')
          .value.trim();

        if (!contact) {
          showToast(`‚ö†Ô∏è Please enter your ${roleLabels[role]} email üìß`);
          return;
        }

        try {
          const response = await fetch(endpoints[role], {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(
              role === "buyer" ? { email: contact } : { contact }
            ),
          });

          const data = await response.json();

          if (!response.ok) {
            switch (response.status) {
              case 404:
                showToast(
                  `‚ùå No ${roleLabels[role]} account found with that email üì≠`
                );
                break;
              case 400:
                showToast("‚ö†Ô∏è Invalid input. Please check your details ‚úèÔ∏è");
                break;
              default:
                showToast(
                  `üö´ ${data.message || "Failed to send reset code üòû"}`
                );
            }
            return;
          }

          showToast(`‚úÖ Reset code sent successfully! Check your inbox üì•‚ú®`);
          form.reset();
        } catch (err) {
          console.error("Error:", err);
          showToast("üõú Connection issue. Please try again üîÅ");
        }
      });
    </script>
  </body>
</html>
