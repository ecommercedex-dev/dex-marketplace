<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop ‚Ä¢ Dex‚Ñ¢</title>
    <link rel="icon" href="../DEX_FAVICON/favicon.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #6ecf45;
        --dark: #0f0f0f;
        --card: #1a1a1a;
        --border: #2a2a2a;
        --text: #e0e0e0;
        --text-dim: #888;
      }

      body {
        font-family: "Quicksand", sans-serif;
        background: var(--dark);
        color: var(--text);
        line-height: 1.6;
      }

      /* Header */
      .header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: rgba(15, 15, 15, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        padding: 1rem 2rem;
      }

      .header-content {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-family: "Fredoka One", cursive;
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
        text-decoration: none;
      }

      .back-btn {
        background: var(--card);
        border: 1px solid var(--border);
        color: var(--text);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
      }

      .back-btn:hover {
        background: var(--primary);
        color: #000;
        border-color: var(--primary);
      }

      /* Hero Banner */
      .hero-banner {
        width: 100%;
        height: 300px;
        background: var(--card);
        position: relative;
        overflow: hidden;
      }

      .hero-banner img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .hero-banner::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 100px;
        background: linear-gradient(to top, var(--dark), transparent);
      }

      /* Shop Header */
      .shop-header {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 2rem;
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 2rem;
        align-items: start;
      }

      .shop-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--primary);
      }

      .shop-info h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .verified-badge {
        background: var(--primary);
        color: #000;
        padding: 0.25rem 0.5rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .response-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(110, 207, 69, 0.1);
        color: var(--primary);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        margin-top: 0.5rem;
      }

      .shop-tagline {
        color: var(--text-dim);
        margin-bottom: 1rem;
      }

      .shop-stats {
        display: flex;
        gap: 2rem;
        margin: 1rem 0;
      }

      .stat span {
        display: block;
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
      }

      .stat small {
        color: var(--text-dim);
        font-size: 0.85rem;
      }

      .shop-actions {
        display: flex;
        gap: 0.75rem;
        flex-direction: column;
      }

      .share-shop {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-dim);
        font-size: 0.9rem;
        margin-top: 0.5rem;
      }

      .share-shop button {
        background: var(--card);
        border: 1px solid var(--border);
        color: var(--text);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .share-shop button:hover {
        border-color: var(--primary);
        color: var(--primary);
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
        text-decoration: none;
      }

      .btn-primary {
        background: var(--primary);
        color: #000;
      }

      .btn-primary:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: var(--card);
        color: var(--text);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        border-color: var(--primary);
      }

      .btn-icon {
        padding: 0.75rem;
        width: 44px;
        height: 44px;
      }

      /* Story Section */
      .story-section {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 2rem;
      }

      .story-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 2rem;
        border-left: 4px solid var(--primary);
      }

      .story-card h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .story-card h2 i {
        color: var(--primary);
      }

      .story-card p {
        line-height: 1.8;
        color: var(--text-dim);
      }

      /* Main Layout */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem 4rem;
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 2rem;
      }

      /* Sidebar */
      .sidebar {
        position: sticky;
        top: 100px;
        height: fit-content;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
      }

      .card h3 {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-dim);
        margin-bottom: 1rem;
      }

      .info-row {
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
      }

      .info-row:last-child {
        border-bottom: none;
      }

      .info-row i {
        color: var(--primary);
        width: 20px;
        margin-right: 0.5rem;
      }

      .info-row a {
        color: var(--primary);
        text-decoration: none;
      }

      /* Safety Tips */
      .safety-card {
        background: #fff;
        color: #333;
        border: none;
        position: relative;
        overflow: hidden;
      }

      .safety-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary);
        transition: background 0.5s;
      }

      .tip-content {
        display: flex;
        align-items: center;
        gap: 1rem;
        min-height: 80px;
      }

      .tip-content i {
        font-size: 2rem;
        color: var(--primary);
      }

      .tip-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 1rem;
      }

      .tip-btn {
        background: var(--primary);
        border: none;
        color: #fff;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        transition: 0.2s;
      }

      .tip-btn:hover {
        opacity: 0.8;
      }

      .tip-dots {
        display: flex;
        gap: 0.5rem;
      }

      .tip-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        transition: 0.2s;
      }

      .tip-dot.active {
        background: var(--primary);
        width: 20px;
        border-radius: 3px;
      }

      /* Products */
      .products-section {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .filters {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .filters-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .input {
        background: var(--card);
        border: 1px solid var(--border);
        color: var(--text);
        padding: 0.75rem 1rem;
        border-radius: 8px;
        font-size: 0.95rem;
        outline: none;
        transition: 0.2s;
        width: 100%;
      }

      .input:focus {
        border-color: var(--primary);
      }

      .search-wrapper {
        position: relative;
        width: 100%;
      }

      .search-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;
      }

      .search-input-wrapper input {
        padding-right: 2.5rem;
        width: 100%;
      }

      .clear-search {
        position: absolute;
        right: 0.75rem;
        background: none;
        border: none;
        color: var(--text-dim);
        cursor: pointer;
        padding: 0.25rem;
        display: none;
        font-size: 1.1rem;
        transition: 0.2s;
      }

      .clear-search:hover {
        color: var(--primary);
      }

      .clear-search.active {
        display: block;
      }

      .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--card);
        border: 1px solid var(--border);
        border-top: none;
        border-radius: 0 0 8px 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 10;
        display: none;
      }

      .search-suggestions.active {
        display: block;
      }

      .suggestion-item {
        padding: 0.75rem 1rem;
        cursor: pointer;
        border-bottom: 1px solid var(--border);
        transition: 0.2s;
      }

      .suggestion-item:last-child {
        border-bottom: none;
      }

      .suggestion-item:hover {
        background: rgba(110, 207, 69, 0.1);
        color: var(--primary);
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 1.5rem;
      }

      .product-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: 0.2s;
        position: relative;
      }

      .product-card:hover {
        border-color: var(--primary);
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(110, 207, 69, 0.2);
      }

      .product-badge {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        background: var(--primary);
        color: #000;
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
        z-index: 10;
      }

      .product-badge.sale {
        background: #e74c3c;
        color: #fff;
      }

      .product-badge.low-stock {
        background: #f39c12;
        color: #000;
      }

      .product-img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background: var(--dark);
      }

      .product-info {
        padding: 1rem;
      }

      .product-name {
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .product-price {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
      }

      .product-stock {
        font-size: 0.85rem;
        color: var(--text-dim);
        margin-top: 0.25rem;
      }

      .loading {
        text-align: center;
        padding: 4rem;
        color: var(--text-dim);
      }

      .loading i {
        font-size: 2rem;
        color: var(--primary);
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translate(-50%, 20px);
        }
        to {
          opacity: 1;
          transform: translate(-50%, 0);
        }
      }

      /* Toast */
      .toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #e74c3c;
        color: #fff;
        padding: 12px 24px;
        border-radius: 8px;
        z-index: 1000;
        font-weight: 600;
        animation: slideUp 0.3s;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      .toast.success {
        background: var(--primary);
        color: #000;
      }

      @media (max-width: 1024px) {
        .container {
          grid-template-columns: 1fr;
        }
        .sidebar {
          position: static;
        }
        .shop-header {
          grid-template-columns: 1fr;
          text-align: center;
        }
        .shop-avatar {
          margin: 0 auto;
        }
        .shop-info h1 {
          justify-content: center;
        }
        .shop-stats {
          justify-content: center;
        }
        .shop-actions {
          flex-direction: row;
          justify-content: center;
          flex-wrap: wrap;
        }
        .share-shop {
          justify-content: center;
        }
      }

      @media (max-width: 768px) {
        .header {
          padding: 0.75rem 1rem;
        }
        .header-content {
          padding: 0;
        }
        .logo {
          font-size: 1.25rem;
        }
        .back-btn {
          padding: 0.4rem 0.8rem;
          font-size: 0.9rem;
        }
        .hero-banner {
          height: 180px;
        }
        .shop-header {
          padding: 0 1rem;
          gap: 1.5rem;
        }
        .shop-avatar {
          width: 90px;
          height: 90px;
        }
        .shop-info h1 {
          font-size: 1.4rem;
        }
        .response-badge {
          font-size: 0.8rem;
          padding: 0.4rem 0.8rem;
        }
        .shop-stats {
          gap: 1rem;
          flex-wrap: wrap;
          justify-content: center;
        }
        .stat span {
          font-size: 1.3rem;
        }
        .stat small {
          font-size: 0.8rem;
        }
        .shop-actions {
          gap: 0.5rem;
        }
        .btn {
          padding: 0.65rem 1.2rem;
          font-size: 0.9rem;
        }
        .story-section {
          padding: 0 1rem;
        }
        .story-card {
          padding: 1.5rem;
        }
        .story-card h2 {
          font-size: 1.3rem;
        }
        .container {
          padding: 0 1rem 2rem;
          gap: 1.5rem;
        }
        .filters-row {
          grid-template-columns: 1fr;
        }
        .products-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
        }
        .product-img {
          height: 140px;
        }
        .product-info {
          padding: 0.75rem;
        }
        .product-name {
          font-size: 0.9rem;
        }
        .product-price {
          font-size: 1.1rem;
        }
        .card {
          padding: 1rem;
          margin-bottom: 0.75rem;
        }
        .card h3 {
          font-size: 0.85rem;
        }
        .tip-content {
          min-height: 60px;
          font-size: 0.9rem;
        }
        .tip-content i {
          font-size: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .header {
          padding: 0.5rem 0.75rem;
        }
        .logo {
          font-size: 1.1rem;
        }
        .back-btn {
          padding: 0.35rem 0.7rem;
          font-size: 0.85rem;
        }
        .hero-banner {
          height: 150px;
        }
        .shop-header {
          padding: 0 0.75rem;
          gap: 1rem;
        }
        .shop-avatar {
          width: 70px;
          height: 70px;
          border-width: 2px;
        }
        .shop-info h1 {
          font-size: 1.1rem;
        }
        .verified-badge {
          font-size: 0.6rem;
          padding: 0.2rem 0.4rem;
        }
        .response-badge {
          font-size: 0.75rem;
          padding: 0.35rem 0.7rem;
        }
        .shop-tagline {
          font-size: 0.85rem;
        }
        .shop-stats {
          gap: 0.75rem;
        }
        .stat span {
          font-size: 1.1rem;
        }
        .stat small {
          font-size: 0.75rem;
        }
        .btn {
          padding: 0.55rem 1rem;
          font-size: 0.85rem;
          gap: 0.35rem;
        }
        .btn i {
          font-size: 0.9rem;
        }
        .share-shop button {
          padding: 0.4rem 0.8rem;
          font-size: 0.85rem;
        }
        .story-section {
          padding: 0 0.75rem;
        }
        .story-card {
          padding: 1rem;
        }
        .story-card h2 {
          font-size: 1.1rem;
        }
        .story-card p {
          font-size: 0.9rem;
          line-height: 1.6;
        }
        .container {
          padding: 0 0.75rem 1.5rem;
          gap: 1rem;
        }
        .products-grid {
          gap: 0.75rem;
        }
        .product-card {
          border-radius: 8px;
        }
        .product-img {
          height: 120px;
        }
        .product-info {
          padding: 0.6rem;
        }
        .product-name {
          font-size: 0.85rem;
        }
        .product-price {
          font-size: 1rem;
        }
        .product-stock {
          font-size: 0.75rem;
        }
        .product-badge {
          font-size: 0.65rem;
          padding: 0.2rem 0.5rem;
          top: 0.5rem;
          right: 0.5rem;
        }
        .card {
          padding: 0.75rem;
        }
        .card h3 {
          font-size: 0.8rem;
        }
        .info-row {
          padding: 0.6rem 0;
          font-size: 0.85rem;
        }
        .tip-content {
          min-height: 50px;
          font-size: 0.85rem;
          gap: 0.75rem;
        }
        .tip-content i {
          font-size: 1.3rem;
        }
        .tip-btn {
          width: 28px;
          height: 28px;
          font-size: 0.8rem;
        }
        .tip-dot {
          width: 5px;
          height: 5px;
        }
        .tip-dot.active {
          width: 16px;
        }
        .input {
          padding: 0.65rem 0.85rem;
          font-size: 0.9rem;
        }
        .search-input-wrapper input {
          padding-right: 2.2rem;
        }
        .clear-search {
          font-size: 1rem;
          right: 0.6rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-content">
        <a href="Dex-shop.html" class="logo">Dex‚Ñ¢</a>
        <button class="back-btn" onclick="history.back()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>
    </header>

    <div class="hero-banner" id="heroBanner" style="display: none"></div>

    <div class="shop-header" id="shopHeader">
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading shop...</p>
      </div>
    </div>

    <div class="story-section" id="storySection" style="display: none"></div>

    <div class="container">
      <aside class="sidebar" id="sidebar" style="display: none"></aside>

      <main class="products-section">
        <div class="filters" id="filters" style="display: none">
          <div class="search-wrapper">
            <div class="search-input-wrapper">
              <input
                type="text"
                id="search"
                class="input"
                placeholder="üîç Search products..."
                autocomplete="off"
              />
              <button class="clear-search" id="clearSearch">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="search-suggestions" id="searchSuggestions"></div>
          </div>
          <div class="filters-row">
            <select id="category" class="input">
              <option value="">All Categories</option>
            </select>
            <select id="sort" class="input">
              <option value="newest">Newest</option>
              <option value="price-asc">Price: Low to High</option>
              <option value="price-desc">Price: High to Low</option>
            </select>
          </div>
        </div>

        <div class="products-grid" id="products"></div>
      </main>
    </div>

    <script>
      const params = new URLSearchParams(location.search);
      const sellerId = params.get("sellerId");
      const BASE = "http://localhost:5000";

      if (!sellerId) {
        document.body.innerHTML =
          '<div class="loading"><p>Missing seller ID</p></div>';
        throw "";
      }

      let allProducts = [];
      let shopSettings = {};

      const SAFETY_TIPS = [
        {
          icon: "handshake",
          text: "Meet in safe, public locations on campus",
          color: "#6ecf45",
        },
        {
          icon: "shield-alt",
          text: "Never share passwords or OTPs with anyone",
          color: "#3498db",
        },
        {
          icon: "eye",
          text: "Inspect items carefully before purchase",
          color: "#e74c3c",
        },
        {
          icon: "comments",
          text: "Keep all communication on platform initially",
          color: "#f39c12",
        },
        {
          icon: "star",
          text: "Check seller ratings and reviews",
          color: "#9b59b6",
        },
        {
          icon: "exclamation-triangle",
          text: "Report suspicious activity immediately",
          color: "#1abc9c",
        },
        {
          icon: "money-bill-wave",
          text: "Never pay before seeing the item in person",
          color: "#e67e22",
        },
        {
          icon: "user-shield",
          text: "Verify seller identity through campus ID",
          color: "#16a085",
        },
        {
          icon: "clock",
          text: "Meet during daylight hours when possible",
          color: "#2980b9",
        },
        {
          icon: "users",
          text: "Bring a friend when meeting sellers",
          color: "#8e44ad",
        },
        {
          icon: "ban",
          text: "Avoid deals that seem too good to be true",
          color: "#c0392b",
        },
        {
          icon: "receipt",
          text: "Request receipts for expensive items",
          color: "#27ae60",
        },
        {
          icon: "mobile-alt",
          text: "Keep your phone charged during meetups",
          color: "#34495e",
        },
        {
          icon: "camera",
          text: "Take photos of items before finalizing deals",
          color: "#d35400",
        },
        {
          icon: "lock",
          text: "Never share personal banking details",
          color: "#c0392b",
        },
        {
          icon: "search",
          text: "Research market prices before buying",
          color: "#2c3e50",
        },
        {
          icon: "file-contract",
          text: "Get written agreements for high-value items",
          color: "#7f8c8d",
        },
        {
          icon: "phone",
          text: "Share meetup details with someone you trust",
          color: "#e74c3c",
        },
        {
          icon: "wallet",
          text: "Carry exact change to avoid complications",
          color: "#f39c12",
        },
        {
          icon: "video",
          text: "Test electronics thoroughly before buying",
          color: "#9b59b6",
        },
      ];

      const render = (items) => {
        const grid = document.getElementById("products");
        if (!items.length) {
          grid.innerHTML =
            '<div class="loading"><p>No products found</p></div>';
          return;
        }
        grid.innerHTML = items
          .map((p) => {
            const isNew =
              new Date(p.createdAt) >
              new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const isLowStock = p.stock > 0 && p.stock <= 5;
            const badge = isNew
              ? '<span class="product-badge">New</span>'
              : isLowStock
              ? '<span class="product-badge low-stock">Low Stock</span>'
              : "";

            return `
          <div class="product-card" onclick="location.href='Dex-product-details.html?id=${
            p.id || p._id
          }'">
            ${badge}
            <img src="${BASE}${
              p.images?.[0] || "/uploads/placeholder.jpg"
            }" alt="${
              p.name
            }" class="product-img" loading="lazy" onerror="this.src='https://via.placeholder.com/260x200/1a1a1a/666?text=No+Image'">
            <div class="product-info">
              <div class="product-name">${p.name}</div>
              <div class="product-price">GHS ${Number(
                p.price
              ).toLocaleString()}</div>
              <div class="product-stock">${
                p.stock > 0 ? `${p.stock} in stock` : "Out of stock"
              }</div>
            </div>
          </div>
        `;
          })
          .join("");
      };

      const applyFilters = () => {
        let filtered = [...allProducts];
        const search = document.getElementById("search").value.toLowerCase();
        const category = document.getElementById("category").value;
        const sort = document.getElementById("sort").value;

        if (search)
          filtered = filtered.filter((p) =>
            p.name?.toLowerCase().includes(search)
          );
        if (category)
          filtered = filtered.filter((p) => p.category === category);

        if (sort === "price-asc") filtered.sort((a, b) => a.price - b.price);
        if (sort === "price-desc") filtered.sort((a, b) => b.price - a.price);
        if (sort === "newest")
          filtered.sort(
            (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
          );

        render(filtered);
      };

      (async () => {
        try {
          const [productsRes, settingsRes] = await Promise.all([
            fetch(`${BASE}/api/products?sellerId=${sellerId}`),
            fetch(`${BASE}/api/shop/settings/public/${sellerId}`),
          ]);

          if (!productsRes.ok) throw new Error("Failed to load");
          
          const data = await productsRes.json();
          allProducts = Array.isArray(data) ? data : data.products || [];
          
          if (settingsRes.ok) {
            shopSettings = await settingsRes.json();
          }

          // Get seller category - check multiple sources
          const seller = allProducts[0]?.seller || {};
          let sellerCategory = seller.productCategory?.toLowerCase() || '';
          
          // If not in seller object, try to get from localStorage (if viewing own shop)
          if (!sellerCategory) {
            const stored = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');
            const currentUser = stored ? JSON.parse(stored) : {};
            if (currentUser.id == sellerId && currentUser.productCategory) {
              sellerCategory = currentUser.productCategory.toLowerCase();
            }
          }
          
          console.log('Seller info:', seller);
          console.log('Seller category:', sellerCategory);
          console.log('Shop settings from DB:', shopSettings);
          let primaryColor = '#6ecf45';
          let accentColor = '#2b7a0b';
          
          if (sellerCategory === 'electronics') {
            primaryColor = '#2196F3';
            accentColor = '#64B5F6';
          } else if (sellerCategory === 'fashion') {
            primaryColor = '#E91E63';
            accentColor = '#F48FB1';
          }
          
          if (shopSettings.primaryColor) primaryColor = shopSettings.primaryColor;
          if (shopSettings.accentColor) accentColor = shopSettings.accentColor;
          
          document.documentElement.style.setProperty("--primary", primaryColor);

          if ((sellerCategory === 'electronics' || sellerCategory === 'fashion')) {
            if (!shopSettings.bannerConfig && !shopSettings.bannerImage) {
              console.log('Creating default banner with colors:', primaryColor, accentColor);
              shopSettings.bannerConfig = { type: "gradient", gradientDirection: "135deg", color1: primaryColor, color2: accentColor };
            }
            if (!shopSettings.logoType && !shopSettings.shopLogo) {
              shopSettings.logoType = "icon";
              shopSettings.logoIcon = sellerCategory === 'electronics' ? 'üì±' : 'üëó';
              shopSettings.logoBackgroundColor = primaryColor;
            }
          }

          // Render banner - prioritize bannerConfig over bannerImage
          console.log("Checking banner config:", shopSettings.bannerConfig);
          console.log("Checking banner image:", shopSettings.bannerImage);
          if (shopSettings.bannerConfig || shopSettings.bannerImage) {
            if (shopSettings.bannerConfig) {
              // Use bannerConfig (builder) if available
              try {
                const config =
                  typeof shopSettings.bannerConfig === "string"
                    ? JSON.parse(shopSettings.bannerConfig)
                    : shopSettings.bannerConfig;
                console.log("Banner config parsed:", config);
                let bannerStyle = "";

                if (config.type === "color") {
                  bannerStyle = `background: ${config.bgColor || "#6ecf45"};`;
                } else if (config.type === "gradient") {
                  const direction = config.gradientDirection || "135deg";
                  bannerStyle = `background: linear-gradient(${direction}, ${
                    config.color1 || "#6ecf45"
                  }, ${config.color2 || "#2b7a0b"});`;
                } else if (config.type === "pattern") {
                  const baseColor = config.patternBaseColor || "#6ecf45";
                  const patternType = config.patternType || "dots";
                  const patterns = {
                    dots: `background: ${baseColor}; background-image: radial-gradient(circle, rgba(255,255,255,0.3) 2px, transparent 2px); background-size: 20px 20px;`,
                    stripes: `background: repeating-linear-gradient(45deg, ${baseColor}, ${baseColor} 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);`,
                    grid: `background: ${baseColor}; background-image: linear-gradient(rgba(255,255,255,0.2) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.2) 1px, transparent 1px); background-size: 20px 20px;`,
                    waves: `background: ${baseColor}; background-image: repeating-linear-gradient(0deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);`,
                  };
                  bannerStyle = patterns[patternType] || patterns.dots;
                } else if (config.image) {
                  const position = config.imagePosition || "center";
                  bannerStyle = `background: url('${config.image}') ${position}/cover;`;
                }

                if (bannerStyle) {
                  console.log("Banner style generated:", bannerStyle);
                  const textSize =
                    config.textSize === "small"
                      ? "1.5rem"
                      : config.textSize === "large"
                      ? "2.5rem"
                      : "2rem";
                  const textStyle =
                    config.textStyle === "bold"
                      ? "font-weight: 700;"
                      : config.textStyle === "italic"
                      ? "font-style: italic;"
                      : config.textStyle === "shadow"
                      ? "text-shadow: 2px 2px 4px rgba(0,0,0,0.5);"
                      : "";

                  const position = config.textPosition || "center";
                  const alignments = {
                    "top-left":
                      "justify-content: flex-start; align-items: flex-start; text-align: left;",
                    "top-center":
                      "justify-content: center; align-items: flex-start; text-align: center;",
                    "top-right":
                      "justify-content: flex-end; align-items: flex-start; text-align: right;",
                    "center-left":
                      "justify-content: flex-start; align-items: center; text-align: left;",
                    center:
                      "justify-content: center; align-items: center; text-align: center;",
                    "center-right":
                      "justify-content: flex-end; align-items: center; text-align: right;",
                    "bottom-left":
                      "justify-content: flex-start; align-items: flex-end; text-align: left;",
                    "bottom-center":
                      "justify-content: center; align-items: flex-end; text-align: center;",
                    "bottom-right":
                      "justify-content: flex-end; align-items: flex-end; text-align: right;",
                  };

                  document.getElementById(
                    "heroBanner"
                  ).innerHTML = `<div style="${bannerStyle} width:100%;height:100%;display:flex;${
                    alignments[position]
                  };padding:2rem;"><h2 style="margin:0;color:${
                    config.textColor || "#ffffff"
                  };font-size:${textSize};${textStyle}">${
                    config.text || ""
                  }</h2></div>`;
                  document.getElementById("heroBanner").style.display = "block";
                  console.log("Banner config displayed");
                } else {
                  console.log("No banner style generated");
                }
              } catch (err) {
                console.error("Banner config error:", err);
              }
            } else if (shopSettings.bannerImage) {
              // Fallback to bannerImage if no bannerConfig
              document.getElementById(
                "heroBanner"
              ).innerHTML = `<img src="${BASE}${shopSettings.bannerImage}" style="width:100%;height:100%;object-fit:cover;">`;
              document.getElementById("heroBanner").style.display = "block";
              console.log("Banner image displayed");
            }
          }

          if (!allProducts.length) {
            document.getElementById("shopHeader").innerHTML =
              '<div class="loading"><p>No products available</p></div>';
            return;
          }
          const phone = (seller.phone || seller.phoneNumber || "")
            .replace(/\D/g, "")
            .replace(/^0/, "233");
          const categories = [
            ...new Set(allProducts.map((p) => p.category).filter(Boolean)),
          ];

          // Generate logo HTML - prioritize shopLogo over logoType
          let logoHTML = "";
          console.log(
            "Logo type:",
            shopSettings.logoType,
            "Shop logo:",
            shopSettings.shopLogo
          );
          if (shopSettings.shopLogo) {
            // Use uploaded logo if available
            logoHTML = `<img src="${BASE}${shopSettings.shopLogo}" alt="${
              seller.name || "Shop"
            }" class="shop-avatar">`;
            console.log("Using uploaded shop logo");
          } else if (
            shopSettings.logoType &&
            shopSettings.logoType !== "upload"
          ) {
            const logoType = shopSettings.logoType;
            const bgColor = shopSettings.logoBackgroundColor || primaryColor;
            const textColor = shopSettings.logoTextColor || "#ffffff";
            const iconColor = shopSettings.logoIconColor || "#ffffff";
            const text = shopSettings.logoText || seller.name || "Shop";
            const icon = shopSettings.logoIcon || "üè™";
            const font = shopSettings.logoFont || "modern";
            const layout = shopSettings.logoLayout || "horizontal";

            const fontStyles = {
              modern: "font-family: Arial, sans-serif; font-weight: bold;",
              classic: "font-family: Times, serif; font-weight: normal;",
              playful:
                "font-family: Comic Sans MS, cursive; font-weight: bold;",
            };

            if (logoType === "text") {
              logoHTML = `<div style="width: 120px; height: 120px; border-radius: 50%; background: ${bgColor}; color: ${textColor}; display: flex; align-items: center; justify-content: center; ${
                fontStyles[font]
              } font-size: 1.2rem; border: 3px solid rgba(255,255,255,0.1);">${text.substring(
                0,
                8
              )}</div>`;
              console.log("Generated text logo");
            } else if (logoType === "icon") {
              logoHTML = `<div style="width: 120px; height: 120px; border-radius: 50%; background: ${bgColor}; color: ${iconColor}; display: flex; align-items: center; justify-content: center; font-size: 3rem; border: 3px solid rgba(255,255,255,0.1);">${icon}</div>`;
              console.log("Generated icon logo");
            } else if (logoType === "combo") {
              if (layout === "vertical") {
                logoHTML = `<div style="width: 120px; height: 120px; border-radius: 50%; background: ${bgColor}; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 3px solid rgba(255,255,255,0.1); padding: 8px;"><div style="color: ${iconColor}; font-size: 2.5rem;">${icon}</div><div style="color: ${textColor}; font-size: 0.9rem; ${
                  fontStyles[font]
                } margin-top: 4px;">${text.substring(0, 8)}</div></div>`;
              } else {
                logoHTML = `<div style="width: 120px; height: 120px; border-radius: 50%; background: ${bgColor}; display: flex; align-items: center; justify-content: center; gap: 8px; border: 3px solid rgba(255,255,255,0.1); padding: 8px;"><div style="color: ${iconColor}; font-size: 2.2rem;">${icon}</div><div style="color: ${textColor}; font-size: 1rem; ${
                  fontStyles[font]
                }">${text.substring(0, 6)}</div></div>`;
              }
              console.log("Generated combo logo");
            }
          }

          // Render shop header
          const defaultAvatar =
            "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ccc'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E";
          const avatarSrc = shopSettings.shopLogo
            ? BASE + shopSettings.shopLogo
            : seller.profilePic || seller.profilePicture
            ? BASE + (seller.profilePic || seller.profilePicture)
            : defaultAvatar;
          const avatarHTML =
            logoHTML ||
            `<img src="${avatarSrc}" alt="${
              seller.name || "Shop"
            }" class="shop-avatar">`;

          document.getElementById("shopHeader").innerHTML = `
            ${avatarHTML}
            <div class="shop-info">
              <h1>
                ${seller.name || "Shop"}
                <span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>
              </h1>
              ${
                shopSettings.tagline
                  ? `<p class="shop-tagline">${shopSettings.tagline}</p>`
                  : ""
              }
              <div class="response-badge">
                <i class="fas fa-bolt"></i>
                <span>Usually responds in 2 hours</span>
              </div>
              <div class="shop-stats">
                <div class="stat">
                  <span>${allProducts.length}</span>
                  <small>Products</small>
                </div>
                <div class="stat">
                  <span>${allProducts.filter((p) => p.stock > 0).length}</span>
                  <small>Available</small>
                </div>
                <div class="stat">
                  <span id="likes">0</span>
                  <small>Likes</small>
                </div>
              </div>
            </div>
            <div class="shop-actions">
              <button class="btn btn-primary" id="likeBtn"><i class="fas fa-heart"></i> Like</button>
              <button class="btn btn-secondary" id="followBtn"><i class="fas fa-user-plus"></i> Follow</button>
              ${
                phone
                  ? `<a href="https://wa.me/${phone}" class="btn btn-secondary" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>`
                  : ""
              }
              <div class="share-shop">
                <button id="shareBtn"><i class="fas fa-share-alt"></i> Share Shop</button>
              </div>
            </div>
          `;

          // Setup share button
          document.getElementById("shareBtn").onclick = () => {
            if (navigator.share) {
              navigator.share({
                title: seller.name || "Shop",
                text: shopSettings.tagline || "Check out this shop on Dex‚Ñ¢",
                url: window.location.href,
              });
            } else {
              navigator.clipboard.writeText(window.location.href);
              const btn = document.getElementById("shareBtn");
              btn.innerHTML = '<i class="fas fa-check"></i> Link Copied!';
              setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-share-alt"></i> Share Shop';
              }, 2000);
            }
          };

          // Setup like/follow with backend
          const likeBtn = document.getElementById("likeBtn");
          const followBtn = document.getElementById("followBtn");
          const likesEl = document.getElementById("likes");
          let likes = 0;
          let isLiked = false;
          let isFollowing = false;

          (async () => {
            try {
              const likesRes = await fetch(
                `${BASE}/api/seller/likes/${sellerId}`
              );
              if (likesRes.ok) {
                const data = await likesRes.json();
                likes = data.count || 0;
                likesEl.textContent = likes;
              }

              const stored =
                localStorage.getItem("currentUser") ||
                sessionStorage.getItem("currentUser");
              const user = stored ? JSON.parse(stored) : {};
              if (user.token) {
                const [likeRes, followRes] = await Promise.all([
                  fetch(`${BASE}/api/seller/like/${sellerId}`, {
                    headers: { Authorization: `Bearer ${user.token}` },
                  }),
                  fetch(`${BASE}/api/seller/follow/${sellerId}`, {
                    headers: { Authorization: `Bearer ${user.token}` },
                  }),
                ]);
                if (likeRes.ok) {
                  const data = await likeRes.json();
                  isLiked = data.isLiked || false;
                  likeBtn.innerHTML = isLiked
                    ? '<i class="fas fa-heart"></i> Liked'
                    : '<i class="far fa-heart"></i> Like';
                  if (isLiked) likeBtn.classList.add("btn-primary");
                }
                if (followRes.ok) {
                  const data = await followRes.json();
                  isFollowing = data.isFollowing || false;
                  if (isFollowing)
                    followBtn.innerHTML =
                      '<i class="fas fa-check"></i> Following';
                }
              }
            } catch (err) {
              console.error("Failed to fetch status:", err);
            }
          })();

          const showToast = (msg, success = false) => {
            const toast = document.createElement("div");
            toast.className = "toast" + (success ? " success" : "");
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
          };

          likeBtn.onclick = async () => {
            const stored =
              localStorage.getItem("currentUser") ||
              sessionStorage.getItem("currentUser");
            const user = stored ? JSON.parse(stored) : {};
            if (!user.token) return alert("Please login to like sellers");
            likeBtn.disabled = true;
            try {
              if (isLiked) {
                const res = await fetch(`${BASE}/api/seller/like/${sellerId}`, {
                  method: "DELETE",
                  headers: { Authorization: `Bearer ${user.token}` },
                });
                if (res.ok) {
                  isLiked = false;
                  likes--;
                  likeBtn.innerHTML = '<i class="far fa-heart"></i> Like';
                  likeBtn.classList.remove("btn-primary");
                  likeBtn.classList.add("btn-secondary");
                  likesEl.textContent = likes;
                } else if (res.status === 403) {
                  const err = await res.json();
                  showToast(err.message || "You can't like your own profile");
                }
              } else {
                const res = await fetch(`${BASE}/api/seller/like`, {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${user.token}`,
                  },
                  body: JSON.stringify({ sellerId: parseInt(sellerId) }),
                });
                if (res.ok) {
                  isLiked = true;
                  likes++;
                  likeBtn.innerHTML = '<i class="fas fa-heart"></i> Liked';
                  likeBtn.classList.remove("btn-secondary");
                  likeBtn.classList.add("btn-primary");
                  likesEl.textContent = likes;
                } else if (res.status === 403) {
                  const err = await res.json();
                  showToast(err.message || "You can't like your own profile");
                }
              }
              likeBtn.style.animation = "pulse 0.3s";
              setTimeout(() => (likeBtn.style.animation = ""), 300);
            } catch (err) {
              console.error("Like error:", err);
              alert("Failed to update like status");
            } finally {
              likeBtn.disabled = false;
            }
          };

          followBtn.onclick = async () => {
            const stored =
              localStorage.getItem("currentUser") ||
              sessionStorage.getItem("currentUser");
            const user = stored ? JSON.parse(stored) : {};
            if (!user.token) return alert("Please login to follow sellers");
            followBtn.disabled = true;
            try {
              if (isFollowing) {
                const res = await fetch(
                  `${BASE}/api/seller/follow/${sellerId}`,
                  {
                    method: "DELETE",
                    headers: { Authorization: `Bearer ${user.token}` },
                  }
                );
                if (res.ok) {
                  isFollowing = false;
                  followBtn.innerHTML =
                    '<i class="fas fa-user-plus"></i> Follow';
                  showToast("Unfollowed", true);
                } else if (res.status === 403) {
                  const err = await res.json();
                  showToast(err.message || "You can't follow your own profile");
                }
              } else {
                const res = await fetch(`${BASE}/api/seller/follow`, {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${user.token}`,
                  },
                  body: JSON.stringify({ sellerId: parseInt(sellerId) }),
                });
                if (res.ok) {
                  isFollowing = true;
                  followBtn.innerHTML =
                    '<i class="fas fa-check"></i> Following';
                  showToast("Following shop!", true);
                } else if (res.status === 403) {
                  const err = await res.json();
                  showToast(err.message || "You can't follow your own profile");
                }
              }
              followBtn.style.animation = "pulse 0.3s";
              setTimeout(() => (followBtn.style.animation = ""), 300);
            } catch (err) {
              console.error("Follow error:", err);
              alert("Failed to update follow status");
            } finally {
              followBtn.disabled = false;
            }
          };

          // Build sidebar
          let sidebarHTML = "";

          // Safety tips
          sidebarHTML += `
            <div class="card safety-card">
              <h3>üõ°Ô∏è Safety Tips</h3>
              <div class="tip-content" id="tipContent"></div>
              <div class="tip-nav">
                <button class="tip-btn" id="prevTip"><i class="fas fa-chevron-left"></i></button>
                <div class="tip-dots" id="tipDots"></div>
                <button class="tip-btn" id="nextTip"><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
          `;

          if (shopSettings.businessHours) {
            sidebarHTML += `
              <div class="card">
                <h3> Business Hours</h3>
                <div class="info-row"><i class="fas fa-clock"></i> ${shopSettings.businessHours}</div>
              </div>
            `;
          }

          if (shopSettings.paymentMethods) {
            sidebarHTML += `
              <div class="card">
                <h3> Payment Methods</h3>
                <div class="info-row"><i class="fas fa-credit-card"></i> ${shopSettings.paymentMethods}</div>
              </div>
            `;
          }

          if (shopSettings.returnPolicy) {
            sidebarHTML += `
              <div class="card">
                <h3>‚Ü© Return Policy</h3>
                <div class="info-row"><i class="fas fa-undo"></i> ${shopSettings.returnPolicy}</div>
              </div>
            `;
          }

          if (
            shopSettings.socialLinks &&
            (shopSettings.socialLinks.instagram ||
              shopSettings.socialLinks.facebook ||
              shopSettings.socialLinks.tiktok)
          ) {
            sidebarHTML += `<div class="card"><h3>üì± Follow Us</h3>`;
            if (shopSettings.socialLinks.instagram) {
              sidebarHTML += `<div class="info-row"><i class="fab fa-instagram"></i> <a href="https://instagram.com/${shopSettings.socialLinks.instagram.replace(
                "@",
                ""
              )}" target="_blank">${
                shopSettings.socialLinks.instagram
              }</a></div>`;
            }
            if (shopSettings.socialLinks.facebook) {
              sidebarHTML += `<div class="info-row"><i class="fab fa-facebook"></i> <a href="${shopSettings.socialLinks.facebook}" target="_blank">Facebook</a></div>`;
            }
            if (shopSettings.socialLinks.tiktok) {
              sidebarHTML += `<div class="info-row"><i class="fab fa-tiktok"></i> <a href="https://tiktok.com/@${shopSettings.socialLinks.tiktok.replace(
                "@",
                ""
              )}" target="_blank">${shopSettings.socialLinks.tiktok}</a></div>`;
            }
            sidebarHTML += `</div>`;
          }

          document.getElementById("sidebar").innerHTML = sidebarHTML;
          document.getElementById("sidebar").style.display = "block";

          // Render story section
          if (shopSettings.aboutShop) {
            document.getElementById("storySection").innerHTML = `
              <div class="story-card">
                <h2><i class="fas fa-book-open"></i> Our Story</h2>
                <p>${shopSettings.aboutShop}</p>
              </div>
            `;
            document.getElementById("storySection").style.display = "block";
          }

          // Setup safety tips
          let currentTip = 0;
          const tipContent = document.getElementById("tipContent");
          const tipDots = document.getElementById("tipDots");
          const safetyCard = document.querySelector(".safety-card");

          tipDots.innerHTML = SAFETY_TIPS.map(
            (_, i) =>
              `<span class="tip-dot ${
                i === 0 ? "active" : ""
              }" data-index="${i}"></span>`
          ).join("");

          const showTip = (index) => {
            currentTip = (index + SAFETY_TIPS.length) % SAFETY_TIPS.length;
            const tip = SAFETY_TIPS[currentTip];
            tipContent.innerHTML = `<i class="fas fa-${tip.icon}"></i><span>${tip.text}</span>`;
            safetyCard.style.setProperty("--primary", tip.color);
            document.querySelectorAll(".tip-dot").forEach((dot, i) => {
              dot.classList.toggle("active", i === currentTip);
            });
          };

          showTip(0);
          document.getElementById("prevTip").onclick = () =>
            showTip(currentTip - 1);
          document.getElementById("nextTip").onclick = () =>
            showTip(currentTip + 1);
          document.querySelectorAll(".tip-dot").forEach((dot) => {
            dot.onclick = () => showTip(parseInt(dot.dataset.index));
          });
          setInterval(() => showTip(currentTip + 1), 5000);

          // Setup filters with search suggestions
          const searchInput = document.getElementById("search");
          const clearBtn = document.getElementById("clearSearch");
          const suggestions = document.getElementById("searchSuggestions");
          let searchTimeout;

          searchInput.oninput = (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim().toLowerCase();
            clearBtn.classList.toggle("active", query.length > 0);
            if (query) {
              const matches = allProducts
                .filter((p) => p.name?.toLowerCase().includes(query))
                .slice(0, 5);
              if (matches.length) {
                suggestions.innerHTML = matches
                  .map((p) => {
                    const div = document.createElement("div");
                    div.className = "suggestion-item";
                    div.textContent = p.name;
                    div.dataset.name = p.name;
                    return div.outerHTML;
                  })
                  .join("");
                suggestions
                  .querySelectorAll(".suggestion-item")
                  .forEach((item) => {
                    item.onclick = () => {
                      searchInput.value = item.dataset.name;
                      searchInput.dispatchEvent(new Event("input"));
                      suggestions.classList.remove("active");
                    };
                  });
                suggestions.classList.add("active");
              } else {
                suggestions.classList.remove("active");
              }
            } else {
              suggestions.classList.remove("active");
            }
            searchTimeout = setTimeout(applyFilters, 300);
          };

          clearBtn.onclick = () => {
            searchInput.value = "";
            clearBtn.classList.remove("active");
            suggestions.classList.remove("active");
            applyFilters();
          };

          document.addEventListener("click", (e) => {
            if (
              !searchInput.contains(e.target) &&
              !suggestions.contains(e.target)
            ) {
              suggestions.classList.remove("active");
            }
          });

          document.getElementById("category").innerHTML =
            '<option value="">All Categories</option>' +
            categories
              .map((c) => `<option value="${c}">${c}</option>`)
              .join("");
          document.getElementById("category").onchange = applyFilters;
          document.getElementById("sort").onchange = applyFilters;
          document.getElementById("filters").style.display =
            shopSettings.showFilters !== false ? "flex" : "none";

          document.title = `${seller.name || "Shop"} ‚Ä¢ Dex‚Ñ¢`;
          render(allProducts);
        } catch (err) {
          console.error(err);
          document.getElementById("shopHeader").innerHTML =
            '<div class="loading"><p>Failed to load shop</p></div>';
        }
      })();
    </script>
  </body>
</html>
