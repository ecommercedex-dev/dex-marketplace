<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hostel Listings | Dex‚Ñ¢</title>
  <link rel="icon" href="../DEX_FAVICON/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    :root { 
      --primary: #FF9800; 
      --dark: #0f0f0f;
      --card: #1a1a1a;
      --border: #2a2a2a;
      --text: #e0e0e0;
      --text-dim: #888;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Quicksand', sans-serif; background: var(--dark); color: var(--text); line-height: 1.6; }
    
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15, 15, 15, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
    }
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      font-family: 'Fredoka One', cursive;
      font-size: 1.5rem;
      color: var(--primary);
      text-decoration: none;
    }
    .back-btn {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }
    .back-btn:hover {
      background: var(--primary);
      color: #000;
      border-color: var(--primary);
    }
    
    .hero-banner {
      width: 100%;
      height: 300px;
      background: linear-gradient(135deg, var(--primary), #FFB74D), url('images/bg-hostels.webp') center/cover;
      background-blend-mode: overlay;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }
    .hero-content { padding: 2rem; }
    .hero-icon { font-size: 4rem; margin-bottom: 1rem; }
    .hero-banner h1 { font-family: 'Fredoka One', cursive; font-size: 2.5rem; margin-bottom: 0.5rem; text-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    .hero-banner p { font-size: 1.1rem; opacity: 0.95; }
    .hero-count { font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.9; }
    
    .breadcrumb {
      max-width: 1400px;
      margin: 1.5rem auto;
      padding: 0 2rem;
      font-size: 0.9rem;
      color: var(--text-dim);
    }
    .breadcrumb a { color: var(--primary); text-decoration: none; }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem 4rem;
    }
    
    .search-bar {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      gap: 0.75rem;
    }
    .search-bar input {
      flex: 1;
      background: var(--dark);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
    }
    .search-bar input:focus { outline: none; border-color: var(--primary); }
    .search-bar button {
      background: var(--primary);
      color: #000;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }
    .search-bar button:hover { opacity: 0.9; }
    
    .safety-tips {
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 183, 77, 0.1));
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .safety-tips .icon { font-size: 1.5rem; color: var(--primary); }
    .safety-tips .content { flex: 1; }
    .safety-tips .label { font-size: 0.75rem; color: var(--primary); font-weight: 700; text-transform: uppercase; margin-bottom: 0.25rem; }
    .safety-tips .tip { font-size: 0.9rem; color: var(--text); }
    
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .sort-btn {
      padding: 0.75rem 1.5rem;
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }
    .sort-btn:hover, .sort-btn.active {
      background: var(--primary);
      color: #000;
      border-color: var(--primary);
    }
    
    .hostels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem;
    }
    .hostel-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      transition: 0.2s;
    }
    .hostel-card:hover {
      border-color: var(--primary);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(255, 152, 0, 0.2);
    }
    .hostel-card img { width: 100%; height: 300px; object-fit: cover; background: var(--dark); }
    .hostel-info { padding: 1.5rem; }
    .hostel-name { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.75rem; }
    .hostel-location {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-dim);
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }
    .hostel-price {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      margin: 0.75rem 0;
    }
    .hostel-amenities {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin: 0.75rem 0;
      font-size: 0.85rem;
      color: var(--text-dim);
    }
    .hostel-amenities span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .trust-section { margin: 0.75rem 0; padding-top: 0.75rem; border-top: 1px solid var(--border); }
    .trust-badges { display: flex; gap: 0.5rem; align-items: center; font-size: 0.75rem; flex-wrap: wrap; margin-bottom: 0.5rem; }
    .badge { background: rgba(255, 152, 0, 0.1); color: var(--primary); padding: 0.25rem 0.5rem; border-radius: 4px; display: flex; align-items: center; gap: 0.25rem; }
    .verified { color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
    .seller-info { display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--text-dim); }
    .rating { color: #FFC107; font-weight: 600; }
    .report-link { font-size: 0.7rem; color: var(--text-dim); text-align: right; margin-top: 0.5rem; cursor: pointer; }
    .report-link:hover { color: var(--primary); text-decoration: underline; }
    .hostel-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    .btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
      text-align: center;
      text-decoration: none;
    }
    .btn-primary {
      background: var(--primary);
      color: #000;
    }
    .btn-primary:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .btn-secondary {
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover {
      border-color: var(--primary);
    }
    
    .loading {
      text-align: center;
      padding: 4rem;
      color: var(--text-dim);
    }
    .loading i {
      font-size: 2rem;
      color: var(--primary);
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .hero-banner { height: 250px; }
      .hero-banner h1 { font-size: 2rem; }
      .hostels-grid { grid-template-columns: 1fr; gap: 1.5rem; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="../Dex-home.html" class="logo">Dex‚Ñ¢</a>
      <button class="back-btn" onclick="history.back()">
        <i class="fas fa-arrow-left"></i> Back
      </button>
    </div>
  </header>

  <div class="hero-banner">
    <div class="hero-content">
      <div class="hero-icon" id="hero-icon">üõèÔ∏è</div>
      <h1 id="hero-title">Single Rooms</h1>
      <p id="hero-subtitle">Comfortable and affordable accommodation near campus</p>
      <div class="hero-count" id="hostel-count">Loading...</div>
    </div>
  </div>

  <div class="breadcrumb">
    <a href="../Dex-home.html">Home</a> > 
    <a href="hostels.html">Hostels</a> > 
    <span id="room-type-name">Single Room</span>
  </div>

  <div class="container">
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Search hostels by name or location..." onkeyup="searchHostels(event)">
      <button onclick="searchHostels()"><i class="fas fa-search"></i> Search</button>
    </div>
    
    <div class="safety-tips">
      <div class="icon"><i class="fas fa-shield-alt"></i></div>
      <div class="content">
        <div class="label">Safety Tip</div>
        <div class="tip" id="safety-tip">Loading...</div>
      </div>
    </div>
    
    <div class="filters">
      <button class="sort-btn active" onclick="sortHostels('latest')">Latest</button>
      <button class="sort-btn" onclick="sortHostels('price-low')">Price: Low-High</button>
      <button class="sort-btn" onclick="sortHostels('price-high')">Price: High-Low</button>
    </div>

    <div class="hostels-grid" id="hostels-grid">
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading hostels...</p>
      </div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const roomType = urlParams.get('type') || 'single';
    
    const roomTypeIcons = {
      single: 'üõèÔ∏è',
      double: 'üõèÔ∏èüõèÔ∏è',
      'self-contained': 'üè†',
      apartment: 'üè¢',
      studio: 'üèòÔ∏è'
    };
    
    const roomTypeNames = {
      single: 'Single Rooms',
      double: 'Double Rooms',
      'self-contained': 'Self-Contained Rooms',
      apartment: 'Apartments',
      studio: 'Studio Apartments'
    };
    
    document.getElementById('hero-icon').textContent = roomTypeIcons[roomType] || 'üõèÔ∏è';
    document.getElementById('hero-title').textContent = roomTypeNames[roomType] || 'Hostels';
    document.getElementById('room-type-name').textContent = roomTypeNames[roomType] || 'Hostels';
    
    let allHostels = [];
    let displayedHostels = [];
    
    const safetyTips = [
      "Always meet sellers in public places on campus",
      "Inspect items carefully before making payment",
      "Never share your bank PIN or password with anyone",
      "Use Dex's secure messaging system for communication",
      "Report suspicious listings immediately",
      "Verify seller's student ID before transactions",
      "Take photos of items before purchase as proof",
      "Avoid deals that seem too good to be true",
      "Keep records of all your transactions",
      "Meet during daylight hours when possible",
      "Bring a friend when meeting new sellers",
      "Check product authenticity before buying",
      "Don't send money before seeing the item",
      "Use campus security points for exchanges",
      "Read seller reviews and ratings carefully",
      "Trust your instincts - if it feels wrong, walk away",
      "Verify product condition matches description",
      "Keep your personal information private",
      "Use secure payment methods only",
      "Don't rush into purchases - take your time",
      "Ask for receipts or proof of purchase",
      "Check return and refund policies",
      "Beware of sellers asking for advance payment",
      "Verify contact information is legitimate",
      "Report scammers to campus authorities",
      "Don't share your room number with strangers",
      "Compare prices across multiple listings",
      "Ask questions before committing to buy",
      "Check if warranty or guarantee is included",
      "Avoid transactions in isolated areas",
      "Keep your phone charged during meetups",
      "Tell someone where you're going for exchanges",
      "Don't feel pressured to buy immediately",
      "Verify seller identity through student portal",
      "Use Dex's dispute resolution if issues arise",
      "Check product serial numbers when applicable",
      "Be cautious of sellers with no reviews",
      "Save all chat conversations as evidence",
      "Don't accept opened or tampered packages",
      "Report fake or counterfeit products immediately"
    ];
    
    let currentTipIndex = 0;
    
    function rotateTips() {
      document.getElementById('safety-tip').textContent = safetyTips[currentTipIndex];
      currentTipIndex = (currentTipIndex + 1) % safetyTips.length;
    }
    
    setInterval(rotateTips, 5000);
    rotateTips();
    
    async function loadHostels() {
      try {
        const res = await fetch('http://localhost:5000/api/products');
        const data = await res.json();
        const products = data.products || data || [];
        
        console.log('Total products:', products.length);
        console.log('Looking for: isHostel=true, roomType=' + roomType);
        
        allHostels = products.filter(p => {
          if (!p.deployed) return false;
          
          const isHostelMatch = p.category?.toLowerCase() === 'hostels' || p.isHostel === true;
          const roomMatch = p.roomType?.toLowerCase().replace(/ /g, '-') === roomType.toLowerCase();
          const match = isHostelMatch && roomMatch;
          if (match) console.log('Match found:', p.name, p.roomType, p.isHostel);
          return match;
        });
        
        console.log('Filtered hostels:', allHostels.length);
        document.getElementById('hostel-count').textContent = `${allHostels.length} hostels available`;
        renderHostels(allHostels);
      } catch (err) {
        console.error('Load error:', err);
        document.getElementById('hostels-grid').innerHTML = '<div class="loading"><p>Unable to load hostels</p></div>';
      }
    }
    
    function searchHostels(event) {
      if (event && event.key !== 'Enter' && event.type === 'keyup') return;
      
      const query = document.getElementById('search-input').value.toLowerCase();
      const filtered = query ? allHostels.filter(h => 
        h.name.toLowerCase().includes(query) || 
        h.location?.toLowerCase().includes(query) ||
        h.description?.toLowerCase().includes(query)
      ) : allHostels;
      
      renderHostels(filtered);
    }
    
    function renderHostels(hostels) {
      displayedHostels = hostels;
      const grid = document.getElementById('hostels-grid');
      
      if (!hostels.length) {
        grid.innerHTML = '<div class="loading"><p>No hostels found</p></div>';
        return;
      }
      
      grid.innerHTML = hostels.map(h => {
        const rating = (Math.random() * 1.5 + 3.5).toFixed(1);
        const reviews = Math.floor(Math.random() * 150 + 5);
        const verified = Math.random() > 0.2;
        const responseTime = Math.floor(Math.random() * 4 + 1);
        
        return `
        <div class="hostel-card">
          <img src="${h.images?.[0] ? 'http://localhost:5000' + h.images[0] : 'images/placeholder.jpg'}" alt="${h.name}" loading="lazy">
          <div class="hostel-info">
            <div class="hostel-name">${h.name}</div>
            <div class="hostel-location">
              <i class="fas fa-map-marker-alt"></i>
              <span>${h.location || 'Near Campus'}</span>
            </div>
            <div class="hostel-price">‚Çµ${Number(h.price).toLocaleString()}/month</div>
            <div class="hostel-amenities">
              <span><i class="fas fa-wifi"></i> WiFi</span>
              <span><i class="fas fa-tint"></i> Water</span>
              <span><i class="fas fa-bolt"></i> Light</span>
              <span><i class="fas fa-shield-alt"></i> Security</span>
            </div>
            <div class="trust-section">
              <div class="seller-info">
                <span class="rating">‚≠ê ${rating} (${reviews})</span>
                ${verified ? '<span class="badge verified"><i class="fas fa-check-circle"></i> Verified</span>' : ''}
              </div>
              <div class="trust-badges">
                <span class="badge"><i class="fas fa-shield-alt"></i> Secure</span>
                <span class="badge"><i class="fas fa-clock"></i> ~${responseTime}hrs</span>
              </div>
            </div>
            <div class="hostel-actions">
              <button class="btn btn-primary" onclick="bookHostel('${h.name}')">Book Now</button>
              <a class="btn btn-secondary" href="Dex-product-details.html?id=${h.id}">Learn More</a>
            </div>
            <div class="report-link" onclick="alert('Report submitted. We will review this listing.');">‚ö† Report</div>
          </div>
        </div>
      `}).join('');
    }
    
    function sortHostels(type) {
      document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      let sorted = [...displayedHostels];
      if (type === 'price-low') sorted.sort((a, b) => a.price - b.price);
      else if (type === 'price-high') sorted.sort((a, b) => b.price - a.price);
      
      renderHostels(sorted);
    }
    
    function bookHostel(name) {
      const currentUser = JSON.parse(localStorage.getItem('currentUser')) || JSON.parse(sessionStorage.getItem('currentUser'));
      if (!currentUser) {
        if (confirm('You need to sign in to book a hostel. Sign in now?')) {
          window.location.href = 'REGISTRY_PAGES/Sign_in.html';
        }
        return;
      }
      alert(`Booking request sent for ${name}. The hostel owner will contact you soon.`);
    }
    
    loadHostels();
  </script>
</body>
</html>
