<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dex™ Shop</title>
    <meta name="description" content="Dex™ Shop - Your campus marketplace" />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* =========================
         THEME & RESET
         ========================= */
      :root {
        --brand-green: #008000;
        --brand-green-soft: #70bb70;
        --brand-green-dark: #056005;
        --muted: #666666;
        --white: #ffffff;
        --glass: rgba(255, 255, 255, 0.06);
        --card-bg: #ffffff;
        --max-width: 1100px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html {
        scroll-behavior: smooth;
        font-family: "Quicksand", sans-serif;
      }
      body {
        min-height: 100vh;
        color: #222;
        background: linear-gradient(rgba(2, 82, 2, 0.6), rgba(0, 0, 0, 0.6)),
          url("images/shop.jpg") center/cover no-repeat;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      a {
        color: inherit;
      }
      button {
        font-family: inherit;
      }

      /* =========================
   PRELOADER (Cinematic Dex™ Shop Edition)
   ========================= */
      #preloader {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        background: #000;
        overflow: hidden;
        z-index: 9999;
        transition: opacity 0.8s ease;
      }

      #preloader .pl-bg {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
        filter: brightness(0.55);
        opacity: 0;
        transform: scale(1.05);
        transition: opacity 1.2s ease-in-out, transform 3s ease;
      }

      #preloader.fade-out {
        opacity: 0;
        pointer-events: none;
      }
      #preloader .pl-bg {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
        filter: brightness(0.55);
        transition: background-image 1s ease-in-out, opacity 1s ease-in-out;
      }
      #preloader .loader-ui {
        position: relative;
        z-index: 2;
        text-align: center;
        color: #fff;
        font-family: "Fredoka One", cursive;
        animation: preFadeIn 1.2s ease forwards;
      }
      .loader-title {
        font-size: 2.4rem;
        margin-bottom: 0.5rem;
        letter-spacing: 1px;
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        opacity: 0;
        transform: translateY(20px);
        animation: fadeSlideUp 1.2s ease forwards;
      }
      .loader-quote {
        font-size: 1rem;
        font-family: "Quicksand", sans-serif;
        font-weight: 400;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.6s ease;
        min-height: 24px;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--brand-green);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 18px auto 0;
      }
      @keyframes fadeSlideUp {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes preFadeIn {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* =========================
         HEADER (glass, match home)
         ========================= */
      header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 2000;
      }
      .header-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 12px 28px;
        background: rgba(0, 128, 0, 0.6);
        backdrop-filter: blur(6px);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
        transition: padding 0.22s ease, background 0.22s ease;
        position: relative;
      }
      .header-bar.scrolled {
        background: rgba(0, 128, 0, 0.86);
        padding: 8px 20px;
      }
      #company-wrap {
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 0;
      }
      h1#company-name a {
        font-family: "Fredoka One", cursive;
        font-size: clamp(1.1rem, 2.6vw, 1.6rem);
        color: #fff;
        text-decoration: none;
        white-space: nowrap;
      }
      nav {
        display: flex;
        align-items: center;
        gap: 14px;
      }
      nav a {
        color: #fff;
        text-decoration: none;
        padding: 8px 10px;
        border-radius: 8px;
        font-weight: 500;
      }
      nav a.active,
      nav a:hover {
        background: var(--brand-green-soft);
        transform: translateY(-2px);
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.12);
      }
      .header-utils {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .header-utils a {
        color: #fff;
        text-decoration: none;
        padding: 6px 10px;
        border-radius: 7px;
      }
      .profile-avatar {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #fff;
      }
      .notification-icon {
        position: relative;
        color: #fff;
        font-size: 1.2rem;
        cursor: pointer;
      }
      .notification-badge {
        position: absolute;
        top: -4px;
        right: -6px;
        background: red;
        color: #fff;
        border-radius: 50%;
        font-size: 0.65rem;
        padding: 2px 5px;
        font-weight: 600;
      }

      /* =========================
         LAYOUT: MAIN + SIDEBAR + CONTENT
         ========================= */
      .page-wrap {
        max-width: var(--max-width);
        margin: 120px auto 60px;
        padding: 0 20px;
        display: grid;
        grid-template-columns: 260px 1fr;
        gap: 28px;
      }
      /* Mobile: stack */
      @media (max-width: 900px) {
        .page-wrap {
          grid-template-columns: 1fr;
          gap: 16px;
          padding: 20px;
          margin-top: 110px;
        }
      }

      /* SIDEBAR */
      .sidebar {
        background: rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        padding: 18px;
        backdrop-filter: blur(6px);
        box-shadow: 0 8px 26px rgba(0, 0, 0, 0.06);
      }
      .sidebar h3 {
        font-family: "Fredoka One", cursive;
        color: var(--brand-green);
        font-size: 1.05rem;
        margin-bottom: 12px;
      }
      .categories {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .category {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        border-radius: 10px;
        cursor: pointer;
        color: #fff;
      }
      .category:hover {
        background: rgba(255, 255, 255, 0.04);
      }
      .category input {
        accent-color: var(--brand-green);
      }

      /* FILTER PANEL (collapsible in top area but also present in sidebar) */
      .filter-card {
        margin-top: 16px;
        background: #fff;
        border-radius: 10px;
        padding: 12px;
        color: #222;
      }
      .filter-card label {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 0.95rem;
        color: var(--muted);
      }
      .price-range {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ddd;
      }

      /* SEARCH + ACTIONS (top of content) */
      .content-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 18px;
        flex-wrap: wrap;
      }
      .search-group {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .search-input {
        padding: 10px 12px;
        border-radius: 10px;
        border: 0;
        min-width: 260px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      }
      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .btn {
        background: var(--brand-green);
        color: #fff;
        border: 0;
        padding: 10px 12px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
      }
      .btn.secondary {
        background: var(--brand-green-soft);
        color: #fff;
      }
      .btn.ghost {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: #fff;
      }

      /* =========================
         PRODUCTS GRID
         ========================= */
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 18px;
      }
      .product-card {
        background: #fff;
        border-radius: 12px;
        padding: 12px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 8px 28px rgba(0, 0, 0, 0.06);
        transition: transform 0.22s ease, box-shadow 0.22s ease;
        opacity: 0;
        transform: translateY(8px);
      }
      .product-card.visible {
        opacity: 1;
        transform: none;
      }
      .product-thumb {
        width: 100%;
        height: 160px;
        border-radius: 8px;
        object-fit: cover;
        display: block;
      }
      .product-body {
        padding: 10px 2px;
        text-align: left;
      }
      .product-body h4 {
        margin-bottom: 6px;
        font-size: 1rem;
        color: #111;
      }
      .product-body p {
        margin: 0;
        color: var(--muted);
        font-size: 0.95rem;
      }
      .price-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        gap: 10px;
      }
      .price {
        font-weight: 700;
        color: var(--brand-green-dark);
      }
      .actions {
        display: flex;
        gap: 8px;
        margin-top: 10px;
      }
      .add-btn {
        flex: 1;
        background: var(--brand-green);
        color: #fff;
        border: 0;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
      }
      .learn-more {
        background: #f0f0f0;
        border-radius: 8px;
        padding: 10px 12px;
        text-decoration: none;
        color: var(--brand-green);
        display: inline-block;
      }
      .product-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.12);
      }

      /* overlay info on hover */
      .overlay {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        border-radius: 12px;
        pointer-events: none;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0) 40%,
          rgba(0, 0, 0, 0.32) 100%
        );
        opacity: 0;
        transition: opacity 0.22s ease;
      }
      .product-card:hover .overlay {
        opacity: 1;
      }

      /* EMPTY fallback */
      .empty {
        padding: 36px;
        text-align: center;
        color: var(--muted);
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
      }

      /* FLOATING CART */
      .floating-cart {
        position: fixed;
        right: 18px;
        bottom: 90px;
        background: linear-gradient(
          180deg,
          var(--brand-green),
          var(--brand-green-dark)
        );
        color: #fff;
        padding: 12px;
        border-radius: 14px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        z-index: 4000;
        cursor: pointer;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .cart-badge {
        background: #fff;
        color: var(--brand-green);
        padding: 4px 8px;
        border-radius: 999px;
        font-weight: 700;
        min-width: 28px;
        text-align: center;
      }

      /* CART PREVIEW (mini) */
      .cart-preview {
        position: fixed;
        right: 18px;
        bottom: 150px;
        width: 320px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.18);
        z-index: 4001;
        overflow: hidden;
        display: none;
      }
      .cart-preview header {
        padding: 12px;
        border-bottom: 1px solid #eee;
        font-weight: 700;
      }
      .cart-items {
        max-height: 240px;
        overflow: auto;
      }
      .cart-item {
        display: flex;
        gap: 10px;
        padding: 10px;
        align-items: center;
        border-bottom: 1px solid #f3f3f3;
      }
      .cart-item img {
        width: 56px;
        height: 48px;
        object-fit: cover;
        border-radius: 6px;
      }
      .cart-empty {
        padding: 12px;
        text-align: center;
        color: var(--muted);
      }

      /* SCROLL TOP */
      #scrollTopBtn {
        position: fixed;
        right: 18px;
        bottom: 24px;
        width: 44px;
        height: 44px;
        border-radius: 10px;
        border: 0;
        background: var(--brand-green);
        color: #fff;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        cursor: pointer;
        z-index: 3500;
        opacity: 0;
        transform: translateY(8px);
        transition: opacity 0.25s ease, transform 0.25s ease;
      }
      #scrollTopBtn.visible {
        opacity: 1;
        transform: none;
      }

      /* FOOTER */
      footer {
        background: rgba(0, 128, 0, 0.75);
        backdrop-filter: blur(6px);
        color: #fff;
        padding: 18px;
        border-top: 2px solid rgba(255, 255, 255, 0.12);
        margin-top: 36px;
        text-align: center;
      }

      /* focus-visible for keyboard users */
      :focus {
        outline: none;
      }
      .show-focus :focus {
        outline: 3px solid rgba(255, 255, 255, 0.18);
        border-radius: 6px;
      }
      /* small screens adjustments */
      /* =========================
   FADE-IN ANIMATION FOR PRODUCT IMAGES
   ========================= */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .product-card.visible {
        animation: fadeInUp 0.6s ease forwards;
      }
      .product-thumb {
        opacity: 0;
        transition: opacity 0.8s ease-in-out;
      }
      .product-card.visible .product-thumb {
        opacity: 1;
      }

      /* =========================
   MOBILE MENU (Dropdown System)
   ========================= */
      #menuToggle {
        display: none;
        font-size: 1.6rem;
        color: #fff;
        background: none;
        border: none;
        cursor: pointer;
        padding: 6px;
        z-index: 2100;
      }

      /* For tablets and below */
      @media (max-width: 1024px) {
        .header-bar {
          padding: 10px 18px;
        }

        nav {
          display: none;
          flex-direction: column;
          background: rgba(0, 128, 0, 0.96);
          position: absolute;
          top: 100%;
          left: 0;
          right: 0;
          padding: 16px;
          border-radius: 0 0 14px 14px;
          box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
          animation: dropdownSlide 0.3s ease forwards;
        }

        nav.active {
          display: flex;
        }

        nav a {
          padding: 12px;
          border-radius: 8px;
          text-align: center;
          font-size: 1rem;
          transition: background 0.25s ease;
        }

        nav a:hover {
          background: rgba(255, 255, 255, 0.12);
        }

        #menuToggle {
          display: block;
        }

        /* Header utilities & brand alignment */
        .header-bar {
          flex-wrap: nowrap;
        }

        #company-wrap {
          flex: 1;
        }

        .header-utils {
          gap: 8px;
        }

        .profile-avatar {
          width: 34px;
          height: 34px;
        }
      }

      /* Phones (600px and below) */
      @media (max-width: 600px) {
        .header-bar {
          padding: 8px 14px;
        }

        .header-utils {
          gap: 6px;
        }

        nav a {
          font-size: 0.95rem;
        }

        .search-input {
          width: 100%;
          min-width: unset;
        }

        .content-head {
          flex-direction: column;
          align-items: stretch;
        }

        .page-wrap {
          margin-top: 100px;
          padding: 14px;
        }

        .sidebar {
          padding: 14px;
        }

        .product-grid {
          grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        }

        footer {
          padding: 12px;
          font-size: 0.9rem;
        }
      }

      /* For very small screens, make utils inside nav stack nicely */
      @media (max-width: 425px) {
        .header-bar > .header-utils {
          display: none;
        }

        #mainNav {
          display: none;
          flex-direction: column;
          gap: 12px;
        }

        #mainNav.active {
          display: flex;
        }

        #mainNav .header-utils {
          flex-direction: row;
          justify-content: flex-start;
          gap: 12px;
          margin-top: 8px;
        }
      }

      /* Animations */
      @keyframes dropdownSlide {
        from {
          opacity: 0;
          transform: translateY(-6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <!-- PRELOADER -->
    <div id="preloader" role="status" aria-hidden="true">
      <div class="pl-bg"></div>
      <div class="loader-ui">
        <h1 class="loader-title">Dex™ Shop</h1>
        <p class="loader-quote"></p>
        <div class="spinner"></div>
      </div>
    </div>

    <!-- HEADER -->
    <header>
      <div class="header-bar" id="headerBar">
        <div id="company-wrap">
          <button
            id="menuToggle"
            aria-label="Toggle menu"
            aria-expanded="false"
          >
            <i class="fas fa-bars" aria-hidden="true"></i>
          </button>
          <h1 id="company-name">
            <a href="../DEX_HOMEPAGES/Dex-home.html">Dex&trade;</a>
          </h1>
        </div>

        <nav aria-label="Primary navigation" id="mainNav">
          <a href="../DEX_HOMEPAGES/Dex-home.html">Home</a>
          <a href="../DEX_HOMEPAGES/Dex-services.html">Services</a>
          <a href="../DEX_HOMEPAGES/Dex-shop.html" class="active">Shop</a>
          <a href="../DEX_CONTACT/Dex-contact.html">Contact</a>
        </nav>

        <div class="header-utils" id="header-utils" aria-live="polite"></div>
      </div>
    </header>

    <!-- MAIN: SIDEBAR + CONTENT -->
    <main class="page-wrap" role="main">
      <!-- SIDEBAR -->
      <aside class="sidebar" aria-label="Shop categories and filters">
        <h3>Categories</h3>
        <div class="categories" id="categoryList">
          <label class="category" data-cat="books">
            <input type="checkbox" data-category="books" /> Books & Stationery
          </label>
          <label class="category" data-cat="food">
            <input type="checkbox" data-category="food" /> Food & Beverages
          </label>
          <label class="category" data-cat="electronics">
            <input type="checkbox" data-category="electronics" /> Electronics &
            Gadgets
          </label>
          <label class="category" data-cat="services">
            <input type="checkbox" data-category="services" /> Campus Services
          </label>
          <label class="category" data-cat="fashion">
            <input type="checkbox" data-category="fashion" /> Fashion & Apparel
          </label>
        </div>

        <div class="filter-card" aria-hidden="false">
          <h4 style="margin-bottom: 8px; color: var(--brand-green)">Refine</h4>
          <label
            ><input type="checkbox" data-category="books" /> Books &
            Notes</label
          >
          <label
            ><input type="checkbox" data-category="food" /> Food &
            Beverages</label
          >
          <label
            ><input type="checkbox" data-category="electronics" />
            Electronics</label
          >
          <label
            ><input type="checkbox" data-category="services" /> Services</label
          >
          <hr
            style="margin: 10px 0; border: none; border-top: 1px solid #eee"
          />
          <label
            style="font-size: 0.95rem; color: var(--muted); margin-bottom: 6px"
            >Price Range</label
          >
          <select id="price-range" class="price-range" aria-label="Price range">
            <option value="all">All prices</option>
            <option value="0-50">₵0 - ₵50</option>
            <option value="51-200">₵51 - ₵200</option>
            <option value="201+">₵201+</option>
          </select>
        </div>
      </aside>

      <!-- CONTENT -->
      <section aria-label="Products area">
        <div class="content-head">
          <div class="search-group">
            <input
              id="search-input"
              class="search-input"
              type="search"
              placeholder="Search products, e.g. charger, hoodie..."
              aria-label="Search products"
            />
            <div class="controls">
              <button id="search-btn" class="btn" aria-label="Search">
                <i class="fas fa-search" aria-hidden="true"></i>
              </button>
              <button
                id="toggleFilters"
                class="btn secondary"
                aria-expanded="false"
                aria-controls="filter-panel"
              >
                Filters
                <i class="fas fa-sliders-h" style="margin-left: 8px"></i>
              </button>
            </div>
          </div>

          <div class="controls" aria-hidden="false">
            <button id="sortBy" class="btn ghost">Sort: Popular</button>
            <button id="clearFilters" class="btn ghost">Clear</button>
          </div>
        </div>

        <!-- optional collapsible filter panel (desktop hidden) -->
        <div id="filter-panel" style="display: none; margin-bottom: 12px"></div>

        <!-- Product grid -->
        <div class="product-section">
          <h3 style="display: none">Products</h3>
          <div id="productGrid" class="product-grid" aria-live="polite"></div>
          <div id="fallback" class="empty" style="display: none">
            No products match your search/filters.
          </div>
        </div>
      </section>
    </main>

    <!-- Floating cart & preview -->
    <div
      class="floating-cart"
      id="floatingCart"
      aria-label="Open cart"
      role="button"
      tabindex="0"
    >
      <i
        class="fas fa-shopping-cart"
        aria-hidden="true"
        style="font-size: 20px"
      ></i>
      <div style="text-align: left">
        <div style="font-weight: 700">Cart</div>
        <div style="font-size: 0.85rem; opacity: 0.95">
          Items: <span id="floating-cart-count" class="cart-badge">0</span>
        </div>
      </div>
    </div>

    <div class="cart-preview" id="cartPreview" aria-hidden="true">
      <header>Cart</header>
      <div class="cart-items" id="cartItems"></div>
      <div
        style="
          padding: 12px;
          display: flex;
          gap: 8px;
          align-items: center;
          justify-content: space-between;
        "
      >
        <div id="cartTotal" style="font-weight: 700">Total: ₵0</div>
        <div>
          <a
            href="cart.html"
            class="btn"
            style="padding: 8px 10px; border-radius: 8px"
            >Go to cart</a
          >
        </div>
      </div>
    </div>

    <!-- Scroll to top -->
    <button id="scrollTopBtn" aria-label="Back to top" title="Back to top">
      <i class="fas fa-chevron-up" aria-hidden="true"></i>
    </button>

    <!-- FOOTER -->
    <footer>
      <div style="max-width: var(--max-width); margin: 0 auto; padding: 0 20px">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
          "
        >
          <div>© 2025 Dex&trade;. All rights reserved.</div>
          <div>
            <a href="../DEX_LEGALPAGES/privacy.html">Privacy Policy</a> |
            <a href="../DEX_LEGALPAGES/terms.html">Terms of Service</a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      /* =========================
         DATA (kept from your file)
         ========================= */
      const products = [
        {
          id: 1,
          name: "Math Notes Pack",
          price: 50,
          category: "books",
          img: "../DEX_HOMEPAGES/sample_products/T-shirt/md-salman-tWOz2_EK5EQ-unsplash.jpg",
        },
        {
          id: 2,
          name: "Android Phone",
          price: 4000,
          category: "electronics",
          img: "../DEX_HOMEPAGES/sample_products/Phones/vojtech-bruzek-J82GxqnwKSs-unsplash.jpg",
        },
        {
          id: 3,
          name: "Charger",
          price: 150,
          category: "electronics",
          img: "../DEX_HOMEPAGES/sample_products/Phones/oscar-nord-8l9VxXI28tY-unsplash.jpg",
        },
        {
          id: 4,
          name: "Campus Tee",
          price: 2000,
          category: "fashion",
          img: "../DEX_HOMEPAGES/sample_products/T-shirt/benjamin-r-iNvK2Xmpx8o-unsplash.jpg",
        },
        {
          id: 5,
          name: "Studio Headset",
          price: 5900,
          category: "electronics",
          img: "../DEX_HOMEPAGES/sample_products/Headsets/robert-torres-oGK9QxOwMAU-unsplash.jpg",
        },
        {
          id: 6,
          name: "Gaming Headset",
          price: 4000,
          category: "electronics",
          img: "../DEX_HOMEPAGES/sample_products/Headsets/robert-torres-oDrBOovU5A8-unsplash.jpg",
        },
        {
          id: 7,
          name: "Student Laptop",
          price: 2000,
          category: "electronics",
          img: "../DEX_HOMEPAGES/sample_products/Laptops/olena-bohovyk-1S_c_O_glv4-unsplash.jpg",
        },
        {
          id: 8,
          name: "Laptop Bag",
          price: 800,
          category: "services",
          img: "../DEX_HOMEPAGES/sample_products/Laptops/dell-Gi3iUJ1FwxI-unsplash.jpg",
        },
        {
          id: 9,
          name: "Campus Hoodie",
          price: 1000,
          category: "fashion",
          img: "../DEX_HOMEPAGES/sample_products/T-shirt/robert-richman-vcTKFYNZop4-unsplash.jpg",
        },
      ];

      /* =========================
         UTILITIES
         ========================= */
      function $(sel) {
        return document.querySelector(sel);
      }
      function $all(sel) {
        return Array.from(document.querySelectorAll(sel));
      }
      function fmtGhc(n) {
        return "₵ " + Number(n).toLocaleString();
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      /* =========================
   PRELOADER WITH IMAGE FADE + SCALE TRANSITION
   ========================= */
      window.addEventListener("load", () => {
        const preloader = document.getElementById("preloader");
        const bg = preloader.querySelector(".pl-bg");
        const quote = preloader.querySelector(".loader-quote");

        const wallpapers = [
          "Images/shop_preloader_wallpaper1.jpg",
          "Images/shop_preloader_wallpaper2.jpg",
          "Images/shop_preloader_wallpaper3.jpg",
          "Images/shop_preloader_wallpaper4.jpg",
        ];

        const quotes = [
          "“Shop smart, live better.”",
          "“Style is a way to say who you are without speaking.”",
          "“Good deals don’t wait — grab them while they’re hot!”",
          "“Happiness is… a full cart and a lighter heart.”",
        ];

        let i = 0;

        const changeSlide = () => {
          // Fade-out + scale-out
          bg.style.opacity = 0;
          bg.style.transform = "scale(1.05)";
          quote.style.opacity = 0;
          quote.style.transform = "translateY(10px)";

          setTimeout(() => {
            // Change wallpaper + quote
            bg.style.backgroundImage = `url('${wallpapers[i]}')`;
            quote.textContent = quotes[i];

            // Fade-in + scale-in
            bg.style.opacity = 1;
            bg.style.transform = "scale(1)";
            quote.style.opacity = 1;
            quote.style.transform = "translateY(0)";

            // Loop index
            i = (i + 1) % wallpapers.length;
          }, 800);
        };

        // Initialize first wallpaper
        bg.style.backgroundImage = `url('${wallpapers[0]}')`;
        quote.textContent = quotes[0];
        setTimeout(() => {
          bg.style.opacity = 1;
          bg.style.transform = "scale(1)";
          quote.style.opacity = 1;
          quote.style.transform = "translateY(0)";
        }, 400);

        // Rotate every 3.5 seconds
        const interval = setInterval(changeSlide, 3500);

        // Remove preloader after 14 seconds
        setTimeout(() => {
          clearInterval(interval);
          preloader.classList.add("fade-out");
          setTimeout(() => preloader.remove(), 800);
        }, 14000);
      });

      /* =========================
         RENDER PRODUCTS
         ========================= */
      const productGrid = $("#productGrid");
      const fallback = $("#fallback");

      function renderProducts(list = products) {
        productGrid.innerHTML = "";
        if (!list || list.length === 0) {
          fallback.style.display = "block";
          return;
        } else fallback.style.display = "none";

        // shuffle for variety
        shuffleArray(list);

        list.forEach((p, idx) => {
          const card = document.createElement("article");
          card.className = "product-card";
          card.innerHTML = `
            <img class="product-thumb" loading="lazy" src="${p.img}" alt="${
            p.name
          }" width="400" height="240" />
            <div class="overlay" aria-hidden="true"></div>
            <div class="product-body">
              <h4>${p.name}</h4>
              <p class="muted">${p.category}</p>
              <div class="price-row">
                <div class="price">${fmtGhc(p.price)}</div>
              </div>
              <div class="actions">
                <button class="add-btn" aria-label="Add ${
                  p.name
                } to cart">Add to cart</button>
                <a class="learn-more" href="product-details.html?id=${
                  p.id
                }">Details</a>
              </div>
            </div>
          `;
          // Attach event
          const addBtn = card.querySelector(".add-btn");
          addBtn.addEventListener("click", () => addToCart(p));

          productGrid.appendChild(card);
          // staggered reveal
          setTimeout(() => card.classList.add("visible"), 80 * idx);
        });
      }

      /* =========================
         FILTERS + SEARCH
         ========================= */
      function getSelectedCategoriesFromSidebar() {
        const checks = Array.from(
          document.querySelectorAll('.sidebar input[type="checkbox"]')
        );
        return checks.filter((c) => c.checked).map((c) => c.dataset.category);
      }

      function getPriceRange() {
        return $("#price-range") ? $("#price-range").value : "all";
      }

      function applyFilters() {
        let list = products.slice();
        const selected = getSelectedCategoriesFromSidebar();
        if (selected.length) {
          list = list.filter((p) => selected.includes(p.category));
        }
        const price = getPriceRange();
        if (price !== "all") {
          if (price === "0-50") list = list.filter((p) => p.price <= 50);
          if (price === "51-200")
            list = list.filter((p) => p.price >= 51 && p.price <= 200);
          if (price === "201+") list = list.filter((p) => p.price >= 201);
        }
        // also respect search query
        const q = $("#search-input").value.trim().toLowerCase();
        if (q)
          list = list.filter(
            (p) =>
              p.name.toLowerCase().includes(q) ||
              p.category.toLowerCase().includes(q)
          );
        renderProducts(list);
      }

      /* -------------------------
         Wire up sidebar category clicks
         ------------------------- */
      $all('.sidebar .category input[type="checkbox"]').forEach((input) => {
        input.addEventListener("change", applyFilters);
      });

      $("#price-range")?.addEventListener("change", applyFilters);

      $("#search-btn")?.addEventListener("click", () => {
        applyFilters();
      });
      $("#search-input")?.addEventListener("input", (e) => {
        if (!e.target.value.trim()) applyFilters();
      });

      $("#clearFilters")?.addEventListener("click", () => {
        $all('.sidebar input[type="checkbox"]').forEach(
          (c) => (c.checked = false)
        );
        $("#price-range").value = "all";
        $("#search-input").value = "";
        renderProducts();
        updateCartCount();
      });

      // toggle compact filter panel on small screens
      $("#toggleFilters")?.addEventListener("click", (e) => {
        const panel = $("#filter-panel");
        const isOpen = panel.style.display === "block";
        panel.style.display = isOpen ? "none" : "block";
        e.currentTarget.setAttribute("aria-expanded", String(!isOpen));
        if (!isOpen) {
          // clone sidebar filters into panel for small screens
          panel.innerHTML = document.querySelector(".filter-card").outerHTML;
          // bind events for those elements
          const clonedChecks = panel.querySelectorAll('input[type="checkbox"]');
          clonedChecks.forEach((ch) =>
            ch.addEventListener("change", () => {
              // mirror to sidebar
              const cat = ch.dataset.category;
              const sidebar = document.querySelector(
                `.sidebar input[data-category="${cat}"]`
              );
              if (sidebar) sidebar.checked = ch.checked;
              applyFilters();
            })
          );
          panel
            .querySelector("#price-range")
            ?.addEventListener("change", (ev) => {
              $("#price-range").value = ev.target.value;
              applyFilters();
            });
        }
      });

      /* =========================
         CART: add, update UI, preview
         ========================= */
      function loadCart() {
        return JSON.parse(localStorage.getItem("cart")) || [];
      }
      function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      function addToCart(product) {
        // check if user logged in (mirror logic from home)
        const currentUser =
          JSON.parse(localStorage.getItem("currentUser")) ||
          JSON.parse(sessionStorage.getItem("currentUser"));
        if (!currentUser) {
          // prompt to sign in (non-blocking)
          if (
            confirm("You need to sign in to add items to cart. Sign in now?")
          ) {
            window.location.href = "REGISTORY_PAGES/Sign_in.html";
            return;
          } else return;
        }

        const cart = loadCart();
        cart.push(product);
        saveCart(cart);
        updateCartCount();
        showToast(`${product.name} added to cart`);
        renderCartPreview();
      }

      function updateCartCount() {
        const cart = loadCart();
        $("#floating-cart-count").textContent = cart.length;
        // also update header badge if present
        const headerBadge = document.querySelector("#headerCartBadge");
        if (headerBadge) headerBadge.textContent = cart.length;
      }

      function renderCartPreview() {
        const cart = loadCart();
        const container = $("#cartItems");
        container.innerHTML = "";
        if (!cart.length) {
          container.innerHTML =
            '<div class="cart-empty">Your cart is empty.</div>';
          $("#cartTotal").textContent = "Total: ₵0";
          return;
        }
        let total = 0;
        cart.forEach((item, i) => {
          total += Number(item.price);
          const row = document.createElement("div");
          row.className = "cart-item";
          row.innerHTML = `
            <img src="${item.img}" alt="${item.name}" />
            <div style="flex:1">
              <div style="font-weight:700">${item.name}</div>
              <div style="font-size:.9rem;color:var(--muted)">${fmtGhc(
                item.price
              )}</div>
            </div>
            <button data-index="${i}" aria-label="Remove item" style="background:transparent;border:0;color:var(--muted);cursor:pointer"><i class="fas fa-trash"></i></button>
          `;
          container.appendChild(row);
        });

        $("#cartTotal").textContent = `Total: ${fmtGhc(total)}`;

        // attach remove handlers
        $all(".cart-item button").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const idx = Number(e.currentTarget.dataset.index);
            const c = loadCart();
            c.splice(idx, 1);
            saveCart(c);
            updateCartCount();
            renderCartPreview();
          });
        });
      }

      // floating cart toggle
      $("#floatingCart").addEventListener("click", () => {
        const preview = $("#cartPreview");
        const isShown = preview.style.display === "block";
        preview.style.display = isShown ? "none" : "block";
        preview.setAttribute("aria-hidden", String(isShown));
      });
      // keyboard accessible
      $("#floatingCart").addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          $("#floatingCart").click();
        }
      });

      /* =========================
         HEADER LINKS + USER UI
         ========================= */
      function createLink(href, text, iconClass) {
        const a = document.createElement("a");
        a.href = href;
        if (iconClass) {
          const i = document.createElement("i");
          i.className = iconClass;
          i.setAttribute("aria-hidden", "true");
          i.style.marginRight = "8px";
          a.appendChild(i);
        }
        const span = document.createElement("span");
        span.textContent = text;
        a.appendChild(span);
        return a;
      }

      function loadHeaderLinks() {
        const headerUtils = $("#header-utils");
        headerUtils.innerHTML = "";
        const currentUser =
          JSON.parse(localStorage.getItem("currentUser")) ||
          JSON.parse(sessionStorage.getItem("currentUser"));
        if (!currentUser) {
          headerUtils.appendChild(
            createLink("REGISTORY_PAGES/Sign_in.html", "Sign in")
          );
          const cartLink = createLink(
            "cart.html",
            "Cart",
            "fas fa-shopping-cart"
          );
          const badge = document.createElement("span");
          badge.id = "headerCartBadge";
          badge.style.marginLeft = "6px";
          badge.style.background = "var(--white)";
          badge.style.color = "var(--brand-green)";
          badge.style.padding = "2px 6px";
          badge.style.borderRadius = "999px";
          cartLink.appendChild(badge);
          headerUtils.appendChild(cartLink);
        } else {
          const img = document.createElement("img");
          img.src = currentUser.profilePic || "../assets/default-avatar.png";
          img.alt = "Profile";
          img.className = "profile-avatar";
          img.style.cursor = "pointer";
          img.addEventListener("click", () => {
            if (currentUser.role === "buyer")
              window.location.href = "REGISTORY_PAGES/Buyer_profile.html";
            else if (currentUser.role === "seller")
              window.location.href = "REGISTORY_PAGES/Sellers_page.html";
            else window.location.href = "REGISTORY_PAGES/Sign_in.html";
          });
          headerUtils.appendChild(img);
          const notif = createLink("#", "Notifications", "fas fa-bell");
          notif.addEventListener("click", () => {
            const roleKey = `${currentUser.role}Notifications`;
            const notes = JSON.parse(localStorage.getItem(roleKey)) || [];
            if (!notes.length) return alert("No new notifications");
            alert(
              notes.map((n) => `• ${n.message || "Notification"}`).join("\\n")
            );
            localStorage.setItem(roleKey, JSON.stringify([]));
          });
          headerUtils.appendChild(notif);
          const cartLink = createLink(
            "cart.html",
            "Cart",
            "fas fa-shopping-cart"
          );
          const badge = document.createElement("span");
          badge.id = "headerCartBadge";
          badge.style.marginLeft = "6px";
          badge.style.background = "var(--white)";
          badge.style.color = "var(--brand-green)";
          badge.style.padding = "2px 6px";
          badge.style.borderRadius = "999px";
          cartLink.appendChild(badge);
          headerUtils.appendChild(cartLink);
          const logout = createLink("#", "Logout");
          logout.addEventListener("click", (e) => {
            e.preventDefault();
            if (confirm("Logout?")) {
              localStorage.removeItem("currentUser");
              sessionStorage.removeItem("currentUser");
              location.reload();
            }
          });
          headerUtils.appendChild(logout);
        }
        updateCartCount();
      }

      /* =========================
         FADE INS + SCROLL STUFF
         ========================= */
      function observeFadeIns() {
        const faders = document.querySelectorAll(".product-card");
        const obs = new IntersectionObserver(
          (entries, ob) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("visible");
                ob.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.12 }
        );
        faders.forEach((f) => obs.observe(f));
      }

      /* Fade-in animation trigger when scrolling into view */
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) entry.target.classList.add("visible");
        });
      });
      document
        .querySelectorAll(".product-card")
        .forEach((card) => observer.observe(card));

      const scrollBtn = document.getElementById("scrollTopBtn");
      window.addEventListener("scroll", () => {
        headerBar.classList.toggle("scrolled", window.scrollY > 60);
        scrollBtn.classList.toggle("visible", window.scrollY > 300);
      });
      scrollBtn.addEventListener("click", () =>
        window.scrollTo({ top: 0, behavior: "smooth" })
      );

      /* =========================
         INITIALIZATION
         ========================= */
      document.addEventListener("DOMContentLoaded", () => {
        renderProducts();
        loadHeaderLinks();
        renderCartPreview();
        updateCartCount();
        observeFadeIns();

        // small keyboard focus helper
        document.body.addEventListener(
          "keydown",
          (e) => {
            if (e.key === "Tab")
              document.documentElement.classList.add("show-focus");
          },
          { once: true }
        );
      });

      // make sure to re-observe when product list changes
      const originalRenderProducts = renderProducts;
      renderProducts = function (list) {
        originalRenderProducts(list);
        observeFadeIns();
      };

      // close cart preview when clicking outside
      document.addEventListener("click", (e) => {
        const preview = $("#cartPreview");
        if (!preview) return;
        if (
          preview.style.display === "block" &&
          !preview.contains(e.target) &&
          !$("#floatingCart").contains(e.target)
        ) {
          preview.style.display = "none";
        }
      });

      // accessibility: close filter panel on outside click
      document.addEventListener("click", (e) => {
        const panel = $("#filter-panel"),
          toggle = $("#toggleFilters");
        if (
          panel &&
          panel.style.display === "block" &&
          !panel.contains(e.target) &&
          !toggle.contains(e.target)
        ) {
          panel.style.display = "none";
          toggle.setAttribute("aria-expanded", "false");
        }
      });

      const menuToggle = document.getElementById("menuToggle");
      const nav = document.getElementById("mainNav");
      const headerUtils = document.getElementById("header-utils");
      const headerBar = document.getElementById("headerBar");

      // Scroll header shrink
      window.addEventListener("scroll", () => {
        if (window.scrollY > 40) headerBar.classList.add("scrolled");
        else headerBar.classList.remove("scrolled");
      });

      // Mobile dropdown toggle
      menuToggle.addEventListener("click", () => {
        const expanded =
          menuToggle.getAttribute("aria-expanded") === "true" || false;
        menuToggle.setAttribute("aria-expanded", !expanded);
        nav.classList.toggle("active");

        // Move header-utils inside nav for small screens
        if (window.innerWidth <= 425) {
          nav.appendChild(headerUtils);
        }

        const icon = menuToggle.querySelector("i");
        if (nav.classList.contains("active")) {
          icon.classList.replace("fa-bars", "fa-times");
        } else {
          icon.classList.replace("fa-times", "fa-bars");

          // Move header-utils back to original place if menu closes
          if (window.innerWidth <= 425) {
            headerBar.appendChild(headerUtils);
          }
        }
      });

      // Optional: handle window resize
      window.addEventListener("resize", () => {
        if (window.innerWidth > 425) {
          // Ensure header-utils stays in the header for larger screens
          if (!headerBar.contains(headerUtils)) {
            headerBar.appendChild(headerUtils);
          }
        }
      });

      // Close nav when link clicked
      document.querySelectorAll("#mainNav a").forEach((link) => {
        link.addEventListener("click", () => {
          nav.classList.remove("active");
          menuToggle.setAttribute("aria-expanded", "false");
          const icon = menuToggle.querySelector("i");
          icon.classList.replace("fa-times", "fa-bars");
        });
      });
    </script>
  </body>
</html>
